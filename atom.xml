<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan SharePoint Support Blog</title>
  
  <subtitle>日本マイクロソフトの SharePoint に関するサポート情報のブログです。</subtitle>
  <link href="https://jpspsupport.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpspsupport.github.io/blog/"/>
  <updated>2025-09-09T08:22:29.866Z</updated>
  <id>https://jpspsupport.github.io/blog/</id>
  
  <author>
    <name>SharePoint Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Teams に投稿された SharePoint リンクが開かない問題について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/Unable-to-open-Teams-link/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/Unable-to-open-Teams-link/</id>
    <published>2025-09-08T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.866Z</updated>
    
    <content type="html"><![CDATA[<p>特定の条件下で、Teams に投稿された SharePoint へのハイパーリンクが開かない事象が発生することがあります。これは複数の製品が関係しており、特定の URL 構造とセキュリティ機能が影響しています。</p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>この問題は、以下の条件が重なった場合に発生する可能性があります。</p><ul><li>  SharePoint サイトのフォルダー名が「数字+ピリオド+日本語」の形式である</li><li>  Teamsクライアントに絶対パスの URL を貼り付けて投稿した際、URLに xsdata 以降の文字列が自動的に付与される(*)</li></ul><p>(*) xsdata 以降の文字列は、Microsoft Defender for Office 365 の ATP（Advanced Threat Protection） による既定の動作です。</p><h2 id="Teams-ATP（Advanced-Threat-Protection）とは？"><a href="#Teams-ATP（Advanced-Threat-Protection）とは？" class="headerlink" title="Teams ATP（Advanced Threat Protection）とは？"></a>Teams ATP（Advanced Threat Protection）とは？</h2><p>ATP は、Microsoft Defender for Office 365 の一部として提供されるセキュリティ機能で、Microsoft Teams、SharePoint Online、OneDrive にアップロード・共有されるファイルやリンクに対して、マルウェアや悪意あるリンクの検出・防御を行います。<br>Teams で共有される SharePoint Online のリンクはブラウザで開かれるため、Safe Links 機能による検査が必要です。</p><h2 id="再現手順"><a href="#再現手順" class="headerlink" title="再現手順"></a>再現手順</h2><ol><li><p>SharePoint のライブラリを作成し、以下のようなフォルダー構成を用意します。</p><p> 「10.TESTフォルダー」 → 「2025年度」 → 「7月出張」</p></li><li><p>「2025年度」フォルダーに移動した状態で、「7月出張」フォルダーの [・・・] → [詳細] → [パス] の右にある [直接リンクをコピーする] をクリックして、「7月出張」フォルダーの絶対パスを取得します。</p></li><li><p>  取得した URL を Teams クライアントに貼り付けて投稿します。</p></li><li><p> Teams 上でリンクをクリックし、ブラウザーで SharePoint サイトを開きます</p></li></ol><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>リンク内の日本語部分が Unicode エスケープされることで、以下の問題が発生します</p><ul><li>  「レンダリングで不明なエラーが発生しました」と表示される</li><li>  フォルダー名の日本語部分が Unicode エスケープされた状態で表示される</li></ul><h2 id="期待される動作"><a href="#期待される動作" class="headerlink" title="期待される動作"></a>期待される動作</h2><ul><li>  日本語部分が Unicode エスケープされず、正しいフォルダー名が表示される   </li><li>  レンダリング エラーが発生しない</li></ul><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><ol><li><p> フォルダー名に「数字 + ピリオド + 日本語」の組み合わせを使用することを避ける</p></li><li><p>フォルダー URL の取得方法を変更する（絶対パスではなく、以下の方法を推奨）：</p><p> a) フォルダーの [・・・] → [リンクのコピー] をクリック</p><p> b) 表示される選択画面上で、リンクの種類を選択します。</p><ul><li>共有する範囲を変更したくない場合、[既存のアクセス権をもつユーザー専用] を選択します。</li></ul><p> c) [適用] → [リンクのコピー] をクリックします。</p></li></ol><br>今回の記事は以上となります。 ご不明点等がありましたら、弊社サポート サービスまでお気軽にお問い合わせください。]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;特定の条件下で、Teams に投稿された SharePoint へのハイパーリンクが開かない事象が発生することがあります。これは複数の製品が関係しており、特定の URL 構造とセキュリティ機能が影響しています。&lt;/p&gt;
&lt;h2 id=&quot;前提条件&quot;&gt;&lt;a href=&quot;#前提条</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>PDF を閲覧する際の監査ログ記録について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/pdf-and-audit-log/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/pdf-and-audit-log/</id>
    <published>2025-09-08T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.875Z</updated>
    
    <content type="html"><![CDATA[<p>本記事では、SharePoint Online 上に保存された PDF ファイルを閲覧した場合に、Microsoft Purview の監査ログに記録されるアクティビティについて説明します。</p><h2 id="監査ログの概要"><a href="#監査ログの概要" class="headerlink" title="監査ログの概要"></a>監査ログの概要</h2><p>SharePoint Online 上でファイルを閲覧 (情報パネルのプレビュー表示を含む) またはダウンロードした場合、その結果、Microsoft Purview の監査ログにアクティビティが記録されます。  <br>通常、ファイルを閲覧した場合は <strong>FileAccessed</strong>、ダウンロードした場合は <strong>FileDownloaded</strong> のアクティビティが記録されます。</p><p>詳細については、以下の公開情報をご参照ください：<br><a href="https://learn.microsoft.com/ja-jp/purview/audit-log-activities">監査ログ アクティビティ | Microsoft Learn</a>  </p><h2 id="PDF-の動作について"><a href="#PDF-の動作について" class="headerlink" title="PDF の動作について"></a>PDF の動作について</h2><p>SharePoint Online 上で PDF ファイルをプレビュー表示した場合、他の Office ファイルとは異なり、監査ログには <strong>FileDownloaded</strong> と記録されます。  <br>これは、PDF ファイルを閲覧する際に内部的にファイルをダウンロードする API が呼び出される仕様によるためです。端末にファイルが保存されることはありませんが、実際にはダウンロード処理が行われるため、<strong>FileDownloaded</strong> のアクティビティが記録されます。</p><p>なお、ファイルのダウンロード権限を持たないユーザーが PDF を閲覧した場合は、内部的なダウンロード処理は行われず、プレビュー用のデータがサービス側で生成・取得されますため、監査ログには <strong>FileAccessed</strong> が記録されます。</p><h2 id="留意事項"><a href="#留意事項" class="headerlink" title="留意事項"></a>留意事項</h2><p>上記の挙動は SharePoint Online の既知の仕様であり、変更の予定も現状ございません。  <br>監査ログをご利用の際は、本仕様をご理解いただくようお願いいたします。</p><p>今回の記事は以上となります。 ご不明点等がありましたら、弊社サポート サービスまでお気軽にお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事では、SharePoint Online 上に保存された PDF ファイルを閲覧した場合に、Microsoft Purview の監査ログに記録されるアクティビティについて説明します。&lt;/p&gt;
&lt;h2 id=&quot;監査ログの概要&quot;&gt;&lt;a href=&quot;#監査ログの概要&quot; c</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>構成キャッシュの再作成 (SharePoint Server)</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-server/clear-configcache/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-server/clear-configcache/</id>
    <published>2025-09-08T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.880Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本投稿は、以前の <a href="https://social.msdn.microsoft.com/Forums/ja-JP/590627a7-d369-47b2-bfc8-7726d7cf9342/2708325104124611251512483124711251712398208772031625104?forum=sharepointsupportteamja" title="構成キャッシュの再作成">SharePoint サポート フォーラムの投稿</a> を元に、内容を一部加筆・修正したものとなります。</p></blockquote><blockquote><p>本投稿は、オンプレミスの SharePoint Server 2013, SharePoint Server 2016, SharePoint Server 2019, SharePoint Server Subscription Edition に適用されます。Microsoft 365 の SharePoint Online には適用されませんので、ご注意ください。</p></blockquote><p>SharePoint Server では、パフォーマンスの観点から、SharePoint の構成データベース (SharePoint_Config) のデータの大部分を、SharePoint サーバー上のローカルのファイル システム内に XML ファイルとしてキャッシュ (構成キャッシュ) を保持しています。</p><p><a href="https://docs.microsoft.com/ja-jp/sharepoint/technical-reference/database-types-and-descriptions#configuration" title="データベースの種類と説明 (SharePoint Server)">データベースの種類と説明 (SharePoint Server)</a></p><p>構成キャッシュは、SharePoint Timer Service (SPTimerV4 / OWSTIMER.EXE) によるタイマー ジョブの実行の際に使用するキャッシュ情報となります。この構成キャッシュの内容に不整合が生じた場合、様々な問題が発生することが過去事例より確認されております。</p><p>&lt;一例&gt;</p><ul><li>SharePoint の各タイマー ジョブが正常に実行されない (“即時の通知” による通知メールが送信されない、SharePoint の診断ログの出力レベルの変更コマンド内容が正常に反映されない、ソリューションの取り消しが行えない、等)</li><li>検索関連の問題が発生する (クロールが開始・完了しない、インデックス リセットが行えない、検索トポロジーの変更ができない、等)</li><li>サイトのアクセスが行えない</li><li>新規のサイト コレクションを作成できない</li></ul><p>上記の事象は、あくまでも構成キャッシュの不整合によって発生した事象の一例となります。弊社サポートにお問合せいただいた際に、構成キャッシュの不整合が疑われるような状況の場合、はじめに弊社サポートからは構成キャッシュの再作成を依頼させていただくことがございます。<br>本投稿では、構成キャッシュの再作成の手順について、具体的な手順をご案内いたします。</p><hr><p>目次</p><ul><li><a href="#%E6%89%8B%E5%8B%95%E3%81%AB%E3%82%88%E3%82%8B%E6%A7%8B%E6%88%90%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%86%8D%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86">手動による構成キャッシュの再作成手順</a><ul><li><a href="#%E4%BD%9C%E6%A5%AD%E3%81%AB%E3%82%88%E3%82%8B%E5%BD%B1%E9%9F%BF">作業による影響</a></li><li><a href="#%E4%BD%9C%E6%A5%AD%E5%AF%BE%E8%B1%A1">作業対象</a></li><li><a href="#%E4%BD%9C%E6%A5%AD%E6%89%8B%E9%A0%86">作業手順</a></li></ul></li><li><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E6%A7%8B%E6%88%90%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%86%8D%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86">スクリプトを使用した構成キャッシュの再作成手順</a><ul><li><a href="#%E4%BD%9C%E6%A5%AD%E3%81%AB%E3%82%88%E3%82%8B%E5%BD%B1%E9%9F%BF-1">作業による影響</a></li><li><a href="#%E4%BD%9C%E6%A5%AD%E5%AF%BE%E8%B1%A1-1">作業対象</a></li><li><a href="#%E4%BD%9C%E6%A5%AD%E6%89%8B%E9%A0%86-1">作業手順</a></li></ul></li><li><a href="#%E6%A7%8B%E6%88%90%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E4%B8%8D%E6%95%B4%E5%90%88%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E8%A6%81%E5%9B%A0">構成キャッシュの不整合が発生する要因</a></li></ul><hr><h2 id="手動による構成キャッシュの再作成手順"><a href="#手動による構成キャッシュの再作成手順" class="headerlink" title="手動による構成キャッシュの再作成手順"></a>手動による構成キャッシュの再作成手順</h2><p>ここでは、手動による構成キャッシュの再作成手順をご案内いたします。</p><h3 id="作業による影響"><a href="#作業による影響" class="headerlink" title="作業による影響"></a>作業による影響</h3><p>SharePoint Server 2016 においては、キャッシュのクリアを実施中にユーザーアクセスが発生した際に、サイトアクセスに失敗するといった事例を確認しております。<br>SharePoint Server 2016 以外の SharePoint Server 製品では同様の事例は確認されておりませんが、構成キャッシュの削除によってページが正常に表示されない事象が発生した場合に備え、構成キャッシュの再作成の手順を実施後に IISRESET コマンドによる IIS の再起動を実施いただくことを推奨しております。<br>IISREST コマンドの実施中は、ユーザーがサイトにアクセス出来なくなるため、ユーザーのご利用の少ない時間帯や営業時間外にご実施ください。<br>また、タイマーサービスの停止中には、一時的にタイマー ジョブが実行されません。このため、作業時間帯にクロールの開始などがスケジュールされていた場合、これらのスケジュールは実行されませんのでご注意ください。<br>ただし、これらは一時的な影響であり、次回のスケジュール時にサービスが再開されていれば問題ございません。</p><h3 id="作業対象"><a href="#作業対象" class="headerlink" title="作業対象"></a>作業対象</h3><p>ローカルの管理者権限を持つアカウントで作業対象の SharePoint サーバーにログオンを行い、<a href="#%E4%BD%9C%E6%A5%AD%E6%89%8B%E9%A0%86">作業手順</a> に記載されている手順を SharePoint サーバーごとに (1 台ずつ) 実施します。</p><h3 id="作業手順"><a href="#作業手順" class="headerlink" title="作業手順"></a>作業手順</h3><ol><li><p>SharePoint サーバー上で動作している SharePoint Timer Service を停止します。</p><ul><li>1-1) [管理ツール] から [サービス] を起動します。</li><li>1-2) サービスの一覧から、”SharePoint Timer Service” を右クリックして、さらに [停止] をクリックします。</li></ul><p> <img src="/blog/sharepoint-server/clear-configcache/01_stop-timer-service.png" alt="SharePoint Timer Service の停止"></p></li><li><p>SharePoint サーバーのローカルのファイル システムに保存されている構成キャッシュ ファイルを削除します。</p><ul><li><p>2-1) レジストリ エディターを起動します。</p></li><li><p>2-2) 下記のレジストリの値 (GUID) を確認します。</p><p>  ※本手順で確認したレジストリの値は、同じファーム内の別の SharePoint サーバーでも同一の値となりますため、これ以降の SharePoint サーバーではレジストリの値を確認する必要はございません。 </p><ul><li>SharePoint Server 2013 の場合: <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Shared Tools\Web ServerExtensions\15.0\Secure\ConfigDB\Id</code></li><li>SharePoint Server 2016, SharePoint Server 2019, SharePoint Server Subscription Edition の場合: <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Shared Tools\Web ServerExtensions\16.0\Secure\ConfigDB\Id</code></li></ul><p>  <img src="/blog/sharepoint-server/clear-configcache/02_regedit.png" alt="構成データベースの ID を確認 (regedit)"></p></li><li><p>2-3) エクスプローラー上で、下記のパスに移動します。下記の画面ショットの通り、XML ファイルが大量に存在するフォルダとなります。</p><p>  <code>%ALLUSERSPROFILE%\Microsoft\SharePoint\Config\&lt;上記手順 2-2 で確認したレジストリの値&gt;</code></p><p>  例) <code>C:\ProgramData\Microsoft\SharePoint\Config\0ae0b94c-5232-4ba9-add3-2b61d7deb90</code></p><p>  <img src="/blog/sharepoint-server/clear-configcache/03_config_cache_folder.png" alt="構成キャッシュのフォルダ"></p></li><li><p>2-4) 上記のフォルダ内の XML ファイルを全て削除します。なお、この際に、同フォルダ内に存在する cache.ini ファイルを誤って削除しないように注意します。</p></li><li><p>2-5) XML ファイルの削除後、cache.ini ファイルをメモ帳で開きます。</p></li><li><p>2-6) cache.ini ファイル内の 1 行目の数値を 1 に変更し、上書き保存をしてファイルを閉じます。</p><p>  <img src="/blog/sharepoint-server/clear-configcache/04_cache_ini_before.png" alt="cache.ini の編集前"><br>  <img src="/blog/sharepoint-server/clear-configcache/05_cache_ini_after.png" alt="cache.ini の編集後"></p></li></ul></li><li><p>停止した SharePoint Timer Service を再開します。</p><ul><li><p>3-1) [管理ツール] から [サービス] を起動します。</p></li><li><p>3-2 サービスの一覧から、”SharePoint Timer Service” を右クリックして、さらに [開始] をクリックします。</p><p>  <img src="/blog/sharepoint-server/clear-configcache/06_start-timer-service.png" alt="SharePoint Timer Service の再開"></p></li></ul></li><li><p>構成キャッシュの再作成が行われていることを確認します。</p><ul><li><p>4-1) 手順 2-3 で移動した構成キャッシュのフォルダ上に、再度 XML ファイルが再作成されていることを確認します。</p></li><li><p>4-2) cache.ini ファイルを開き、1 以外の数値となっていることを確認します。</p><p>  ※SharePoint Timer Service の再起動後、数分間は cache.ini がロックされた状態になります。その場合は少し時間を空けてから再度ご確認ください。</p></li></ul></li><li><p>IIS の再起動を行います。</p><ul><li><p>5-1) コマンド プロンプトを管理者権限で起動します。</p></li><li><p>5-2) <code>iisreset /noforce</code> コマンドを実行し、IIS の再起動を行います。</p><p>  <em>※IIS の再起動が完了するまで、一時的にユーザーがサイトにアクセス出来なくなるため、ご注意ください。</em></p></li></ul></li></ol><blockquote><p><strong>補足: IIS の再起動について</strong><br>SharePoint Server では、これまで iisreset コマンドをご案内しており、実際に多くのお客様環境で問題なくご利用いただいていますが、厳密には IIS 観点ではサポート対象外となっております。<br>そのため、より確実で推奨される方法としては、IIS マネージャーを使用して以下の手順で再起動いただくことをおすすめいたします。</p><p><strong>IIS サービスの再起動 (IIS マネージャーを使用する場合)</strong></p><ol><li>SharePoint サーバーに管理者権限でログインします。</li><li>IIS マネージャーを起動します。</li><li>サーバー名を選択し、画面右側の [操作] ウィンドウで [再起動] をクリックします。</li></ol><p>IIS の再起動中は一時的にユーザーがサイトにアクセスできなくなりますので、ユーザー影響の少ない時間帯に実施ください。</p></blockquote><hr><h2 id="スクリプトを使用した構成キャッシュの再作成手順"><a href="#スクリプトを使用した構成キャッシュの再作成手順" class="headerlink" title="スクリプトを使用した構成キャッシュの再作成手順"></a>スクリプトを使用した構成キャッシュの再作成手順</h2><p>ここでは、<a href="#%E6%89%8B%E5%8B%95%E3%81%AB%E3%82%88%E3%82%8B%E6%A7%8B%E6%88%90%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%86%8D%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86">手動による構成キャッシュの再作成手順</a> と同等の手順を実施するための PowerShell スクリプトをご案内いたします。<br>なお、本スクリプトでは、<a href="#%E6%89%8B%E5%8B%95%E3%81%AB%E3%82%88%E3%82%8B%E6%A7%8B%E6%88%90%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%86%8D%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86">手動による構成キャッシュの再作成手順</a> における IISRESET コマンド (手順 5-2) の処理は含まれておりませんため、管理者様にて別途ご実施いただく必要がございます。</p><h3 id="作業による影響-1"><a href="#作業による影響-1" class="headerlink" title="作業による影響"></a>作業による影響</h3><p><a href="#%E6%89%8B%E5%8B%95%E3%81%AB%E3%82%88%E3%82%8B%E6%A7%8B%E6%88%90%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%86%8D%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86">手動による構成キャッシュの再作成手順</a> をご参考ください。</p><h3 id="作業対象-1"><a href="#作業対象-1" class="headerlink" title="作業対象"></a>作業対象</h3><p>ローカルの管理者権限を持ったファーム アカウントで作業対象の SharePoint サーバーにログオンを行い、<a href="#%E4%BD%9C%E6%A5%AD%E6%89%8B%E9%A0%86-1">作業手順</a> に記載されている手順を SharePoint サーバーごとに (1 台ずつ) 実施します。</p><h3 id="作業手順-1"><a href="#作業手順-1" class="headerlink" title="作業手順"></a>作業手順</h3><ol><li><p>スクリプトを GitHub から入手し、作業対象の SharePoint サーバーに配置します。</p><ul><li><p>1-1) 以下の URL にアクセスし、画面右上の [Code] - [Download Zip] でダウンロードした zip ファイルに含まれる Clear-SPConfigCache.ps1 を、作業対象の SharePoint サーバー上に展開します。</p><p>  <a href="https://github.com/jpspsupport/Clear-SPConfigCache">https://github.com/jpspsupport/Clear-SPConfigCache</a></p><p>  ※以降の手順では、SharePoint サーバー上のローカルの “C:\temp” に展開したことを想定します。(C:\temp\Clear-SPConfigCache.ps1)</p></li><li><p>1-2) [スタート] メニューから、[Microsoft SharePoint Products] 内の [SharePoint 管理シェル] を右クリックして [管理者として実行] をクリックします。(管理シェルの名称は、ご利用の製品バージョンに読み替えます。)</p></li><li><p>1-3) 下記のコマンドによってスクリプトを実行します。</p><blockquote><p>C:\temp\Clear-SPConfigCache.ps1</p></blockquote><p>  ※PowerShell のスクリプト実行ポリシーによっては、インターネットから入手したスクリプトの実行が制限されている可能性がございます。その場合、下記のコマンドによって、一時的にスクリプトの実行ポリシーを変更した状態でスクリプトを実行します。</p><blockquote><p>powershell -ExecutionPolicy Bypass -Command “C:\temp\Clear-SPConfigCache.ps1”</p></blockquote></li><li><p>1-4) スクリプトの実行時に、下記のようなメッセージが管理シェル上に出力され構成キャッシュが削除されます。</p><p>  ※最後に IIS の再起動を促すメッセージ (Run ‘iisreset /noforce’ manually.) が表示されますが、このタイミングでは IIS の再起動は行われておりません。</p><blockquote><p> Stopping SharePoint Timer Service …<br> Succeeded to stop SharePoint Timer Service.<br> Clearing configuration cache files of ‘SharePoint_Config’ (&lt;GUID&gt;) …<br> Deleting &lt;number of XML files&gt; XML files …<br> Deleted.<br> Modifying cache.ini file …<br> Succeeded to modify cache.ini file.<br> Succeeded to clear configuration cache files of ‘SharePoint_Config’ (&lt;GUID&gt;).<br> Restarting SharePoint Timer Service …<br> Succeeded to restart SharePoint Timer Service.<br> Run ‘iisreset /noforce’ manually.</p></blockquote></li></ul></li><li><p>IIS の再起動を行います。</p><ul><li><p>2-1) コマンド プロンプトを管理者権限で起動します。</p></li><li><p>2-2) <code>iisreset /noforce</code> コマンドを実行し、IIS の再起動を行います。</p><p>  <em>※IIS の再起動が完了するまで、一時的にユーザーがサイトにアクセス出来なくなるため、ご注意ください。</em></p></li></ul></li></ol><h2 id="構成キャッシュの不整合が発生する要因"><a href="#構成キャッシュの不整合が発生する要因" class="headerlink" title="構成キャッシュの不整合が発生する要因"></a>構成キャッシュの不整合が発生する要因</h2><p>構成キャッシュの不整合が発生する状況といたしましては、SharePoint のプロセスがキャッシュに書き込みを行うタイミングで、SharePoint 以外のプロセスがキャッシュ ファイル (またはフォルダ) をロックしているため、書き込みに失敗した状況が考えられます。<br>しかしながら、過去 (構成キャッシュの不整合が発生したタイミング) に遡ってログを取得することは不可能であり、構成キャッシュに不整合が発生する具体的な原因を、不整合が発生した後から特定できません。<br>構成キャッシュの不整合が発生する要因といたしましては、キャッシュのフォルダがウィルス対策ソフトの監視対象になっている場合、キャッシュ ファイルの更新などに失敗することが報告されております。<br>このため、以下の技術情報をご参考いただき、ご利用のウィルス対策ソフトで除外設定についてご確認ください。</p><p><a href="https://support.microsoft.com/en-us/office/certain-folders-may-have-to-be-excluded-from-antivirus-scanning-when-you-use-file-level-antivirus-software-in-sharepoint-01cbc532-a24e-4bba-8d67-0b1ed733a3d9?ui=en-us&rs=en-us&ad=us" title="Certain folders may have to be excluded from antivirus scanning when you use file-level antivirus software in SharePoint">Certain folders may have to be excluded from antivirus scanning when you use file-level antivirus software in SharePoint</a></p><p>※ SharePoint Server 2013 をご利用の場合は、SharePoint Foundation 2013 に記載のフォルダについても除外対象設定を実施ください。</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本投稿は、以前の &lt;a href=&quot;https://social.msdn.microsoft.com/Forums/ja-JP/590627a7-d369-47b2-bfc8-7726d7cf9342/2708325104124611251512</summary>
      
    
    
    
    
    <category term="SharePoint Server" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Server/"/>
    
  </entry>
  
  <entry>
    <title>サブサイトまたはライブラリの URL にマルチバイト文字を含めるとアクセスできない場合があります</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/multibyte-url/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/multibyte-url/</id>
    <published>2025-02-27T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.874Z</updated>
    
    <content type="html"><![CDATA[<p>本記事では、SharePoint Online の サブサイトまたはライブラリの URL に日本語などのマルチバイト文字が含まれていることで、サイトへの接続がエラーとなる事象と対処方法を説明します。</p><h2 id="事象について"><a href="#事象について" class="headerlink" title="事象について"></a>事象について</h2><p>サブサイトやライブラリの URL に日本語などのマルチバイト文字が含まれている場合に、対象のサブサイトやライブラリにアクセスできなくなる事象が過去に確認されています。</p><p>本事象が発生した場合、「このページは表示できません」(Edge ブラウザーの場合) のエラーメッセージがブラウザーに表示されます。ただし、このエラーはネットワーク観点の問題が発生している可能性があることを示す内容であるため、エラーの内容からただちに本問題に該当しているか判断することはできません。<br>切り分けとして、他の SharePoint サイトにアクセスした場合の動作についても調査を行い、特定の SharePoint サイトやライブラリのみで接続できない状態なのかを確認することで、本問題に該当しているかを判断する必要があります。</p><p>なお、本事象は確率的に発生し、発生した場合でもネットワーク環境を切り替えることや時間経過により自然に解消することもあり、現時点では具体的な要因は特定されていません。</p><p>サブサイトやライブラリの URL にマルチバイト文字を含めてしまった場合は、後述する方法で半角英数字のみの別の URL に変更を実施してください。</p><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>以下の方法にて、サブサイトまたはライブラリの URL を変更することができます。</p><h3 id="サブサイトの-URL-を変更する場合"><a href="#サブサイトの-URL-を変更する場合" class="headerlink" title="サブサイトの URL を変更する場合"></a>サブサイトの URL を変更する場合</h3><p>サブサイトの URL は GUI から変更します。</p><ol><li><p>サブサイトを開き、画面右上の設定アイコンから [サイト情報] を選択します。<br><img src="/blog/sharepoint-online/multibyte-url/Subsite01.png" alt="Subsite01.png"> </p></li><li><p>[すべてのサイト設定を表示] を選択します。<br><img src="/blog/sharepoint-online/multibyte-url/Subsite02.png" alt="Subsite02.png"></p></li><li><p>外観 カテゴリの [タイトル、説明、ロゴ] を選択します。<br><img src="/blog/sharepoint-online/multibyte-url/Subsite03.png" alt="Subsite03.png"></p></li><li><p>URL 名を半角英数字に変更し、[OK] を選択します。<br><img src="/blog/sharepoint-online/multibyte-url/Subsite04.png" alt="Subsite04.png"></p></li></ol><h3 id="ライブラリの-URL-を変更する場合"><a href="#ライブラリの-URL-を変更する場合" class="headerlink" title="ライブラリの URL を変更する場合"></a>ライブラリの URL を変更する場合</h3><p>ライブラリの URL は PnP PowerShell で変更します。</p><p>【事前準備】</p><ul><li>PnP PowerShell の使用には PowerShell 7.4.4 以降が必要です。インストールについては下記公開情報を参照してください。<br>参照：<a href="https://learn.microsoft.com/ja-jp/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.4">Windows への PowerShell 7.4 のインストール</a></li><li>PnP PowerShell を初めて利用する場合は、下記の公開情報を参照してモジュールのインストールやアプリケーションの登録などを実施してください。<br>参照：<a href="https://learn.microsoft.com/ja-jp/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets">PnP PowerShell の概要 | Microsoft Learn</a></li></ul><ol><li><p>PowerShell 7 を管理者として実行します。</p></li><li><p>以下を 1 行ずつ実行します。</p></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Connect-PnPOnline</span> <span class="literal">-Url</span> <span class="string">&quot;&lt;サイト URL&gt;&quot;</span> <span class="literal">-ClientId</span> <span class="string">&quot;&lt;PnP PowerShell 用に登録したアプリケーションの Client ID&gt;&quot;</span> <span class="literal">-Interactive</span></span><br><span class="line"><span class="variable">$list</span> = <span class="built_in">Get-PnPList</span> <span class="string">&quot;&lt;現在のライブラリ名&gt;&quot;</span></span><br><span class="line"><span class="variable">$list</span>.RootFolder.MoveTo(<span class="string">&quot;&lt;半角英数字のみで構成する変更後のライブラリ パス (例 :DocLib001)&gt;&quot;</span>)</span><br><span class="line"><span class="variable">$list</span>.Update()</span><br><span class="line"><span class="built_in">Invoke-PnPQuery</span></span><br></pre></td></tr></table></figure><p><strong>NOTE</strong></p><ul><li>1行目のコマンド実行後の PnP PowerShell へのログインは、サイト管理者の権限をもつユーザーで実施してください。</li><li>“ Invoke-PnPQuery: テンプレートの URL が正しくありません。/ Invoke-PnPQuery: Invalid template URL.” というメッセージが表示されますが、異常ではありません。</li></ul><p>例：<br><img src="/blog/sharepoint-online/multibyte-url/PowerShell01.png" alt="PowerShell01.png"></p><ol start="3"><li>上記コマンドを実行後、数分経過後に変更後の URL にアクセスし、事象が解消されページが閲覧できることを確認してください。新しい URL でも引き続き問題が生じる場合は、一度ブラウザーのキャッシュをクリアしてからご確認ください。</li></ol><br>今回の記事は以上となります。 ご不明点等がありましたら、弊社サポート サービスまでお気軽にお問い合わせください。]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事では、SharePoint Online の サブサイトまたはライブラリの URL に日本語などのマルチバイト文字が含まれていることで、サイトへの接続がエラーとなる事象と対処方法を説明します。&lt;/p&gt;
&lt;h2 id=&quot;事象について&quot;&gt;&lt;a href=&quot;#事象について&quot;</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>SharePoint Server の更新プログラムの適用方法について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-server/install-software-update/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-server/install-software-update/</id>
    <published>2024-12-25T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.882Z</updated>
    
    <content type="html"><![CDATA[<p>本記事では、オンプレミスの SharePoint Server 製品に対する一般的な更新プログラムの適用手順を説明します。 <br>対象は、以下のオンプレミス環境です。</p><ul><li>SharePoint Server Subscription Edition</li><li>SharePoint Server 2019</li><li>SharePoint Server 2016</li></ul><p>Microsoft 365 の SharePoint Online は対象外となりますのでご注意ください。 </p><span id="more"></span><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="https://jpspsupport.github.io/blog/sharepoint-server/install-software-update/#SharePoint-Server-%E8%A3%BD%E5%93%81%E3%81%AE%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">SharePoint Server 製品の更新プログラムについて</a></li><li><a href="https://jpspsupport.github.io/blog/sharepoint-server/install-software-update/#SharePoint-Server-%E8%A3%BD%E5%93%81%E3%81%AE%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E9%81%A9%E7%94%A8%E6%89%8B%E9%A0%86">SharePoint Server 製品の更新プログラム適用手順</a><ul><li><a href="#1-%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">1. 更新プログラムのダウンロード</a></li><li><a href="#2-%E6%9B%B4%E6%96%B0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">2. 更新プログラムのインストール</a></li><li><a href="https://jpspsupport.github.io/blog/sharepoint-server/install-software-update/#3-SharePoint-%E8%A3%BD%E5%93%81%E6%A7%8B%E6%88%90%E3%82%A6%E3%82%A3%E3%82%B6%E3%83%BC%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C">3. SharePoint 製品構成ウィザードの実行</a></li><li><a href="#4-%E9%81%A9%E7%94%A8%E3%81%AE%E7%A2%BA%E8%AA%8D">4. 適用の確認</a></li></ul></li></ul><h2 id="SharePoint-Server-製品の更新プログラムについて"><a href="#SharePoint-Server-製品の更新プログラムについて" class="headerlink" title="SharePoint Server 製品の更新プログラムについて"></a>SharePoint Server 製品の更新プログラムについて</h2><p>毎月発行される SharePoint Server の更新プログラムは、累積的な更新プログラムです。<br>具体的には、ある月における SharePoint Server の更新プログラムには、それ以前の更新プログラムでリリースされた脆弱性の対応や不具合の修正も含まれています。そのため、過去の修正内容を適用するために過去の更新プログラムを適用する必要はありませんし、インストールされている更新プログラムより古いものは適用できないようになっています。 </p><p>また、SharePoint Server では、<strong>言語に依存しない修正を含む更新プログラムと、言語に依存する修正を含んだ更新プログラム (“MUI / 言語パッチ”) の 2 種類が存在し、双方を適用する必要</strong>があります。前者は毎月リリースされますが、後者は必ずしも毎月リリースされるわけではありません。言語に依存しない更新プログラムがリリースされた月に “MUI / 言語パッチ” がリリースされていない場合は、 “MUI / 言語パッチ” については、その月以前にリリースされた最新版を適用します。 </p><p>一方で、SharePoint Server Subscription Edition においては、2023 年 3 月以降、上記 2 種類の更新プログラムが統合された単一の更新プログラムがリリースされるようになりました。これによって、現在の SharePoint Server Subscription Edition 製品においては、毎月リリースされる単一の更新プログラムを適用すれば最新の状態に更新することが可能となっています。 </p><p>適用する更新プログラムの例を、パターン別にご紹介します。</p><p><strong><em>例 1 : “SharePoint Server Subscription Edition” を 2024 年 11 月時点の最新状態にする場合</em></strong><br>2024 年 11月リリースの KB 5002651 を適用します。<br>※ 現在の SharePoint Server Subscription Edition の更新プログラムは、言語に依存しない / 依存する更新プログラムの両方が含まれた単一の更新プログラムとなっています。<br><img src="/blog/sharepoint-server/install-software-update/CU-example01.png"></p><p><strong><em>例 2 : “SharePoint Server 2019” を 2024 年 11 月時点の最新状態にする場合</em></strong><br>言語に依存しない更新プログラムとして、2024 年 11月リリースの KB 5002650 を適用します。<br>言語に依存する MUI / 言語パッチは 2024 年 11 月にリリースされていないため、最新の 2024 年 8 月リリースの KB 5002597 を適用します。<br><img src="/blog/sharepoint-server/install-software-update/CU-example02.png"></p><p><strong><em>例 3 : “SharePoint Server 2016” を 2024 年 11 月時点の最新状態にする場合</em></strong><br>言語に依存しない更新プログラムとして、2024 年 11月リリースの KB 5002654 を適用します。<br>言語に依存する MUI / 言語パッチは 2024 年 11 月にリリースされていないため、最新の 2023 年 12 月リリースの KB 5002524 を適用します。<br><img src="/blog/sharepoint-server/install-software-update/CU-example03.png"></p><h2 id="SharePoint-Server-製品の更新プログラム適用手順"><a href="#SharePoint-Server-製品の更新プログラム適用手順" class="headerlink" title="SharePoint Server 製品の更新プログラム適用手順"></a>SharePoint Server 製品の更新プログラム適用手順</h2><p>下記は、オンプレミスの SharePoint Server 製品における一般的な適用手順です。</p><p>更新プログラム適用時のベスト プラクティスについては、弊社エンジニアの下記 Blog 記事をご参照ください。</p><blockquote><p>参照 : <a href="https://blog.stefan-gossner.com/2020/02/11/sharepoint-patching-best-practices/">SharePoint Patching Best Practices – Stefan Goßner</a></p></blockquote><p>更新プログラムの適用にあたり、以下の注意事項をご確認ください。</p><ul><li><p>更新プログラムは個別にアンインストールできません。</p></li><li><p>更新プログラムを適用する前に、システムおよび SharePoint の完全なバックアップを実施することを強く推奨いたします。特に、カスタマイズや設定変更を実施されている場合は、更新プログラムの適用により現在の設定が既定の設定に置き換わる場合がありますので、カスタマイズや設定変更に関するバックアップも取得してください。<br><br>例：\Program Files\Common Files\Microsoft Shared\web server extensions\ フォルダ下のファイルを直接変更している、SharePoint に関連するレジストリ、データベースの権限を変更している等</p></li><li><p>SharePoint 製品とテクノロジに、独自に開発したカスタム Web パーツやワークフローなどのソリューションを組み込んでいる場合は、カスタマイズの内容が更新プログラムの適用に伴う動作変更や更新の影響を受ける可能性があります。検証環境において、事前の動作検証を実施することを推奨いたします。</p></li></ul><h3 id="1-更新プログラムのダウンロード"><a href="#1-更新プログラムのダウンロード" class="headerlink" title="1. 更新プログラムのダウンロード"></a>1. 更新プログラムのダウンロード</h3><p>下記の公開情報から適用する更新プログラムを確認し、ダウンロードします。</p><blockquote><p>参照 : <a href="https://learn.microsoft.com/ja-jp/officeupdates/sharepoint-updates">SharePoint 更新プログラム - Office release notes | Microsoft Learn</a> </p></blockquote><ol><li><p>上記公開情報から対象の更新プログラムをクリックし、説明ページを開きます。<br>例：<br><img src="/blog/sharepoint-server/install-software-update/CU-download01.png"></p></li><li><p>Microsoft ダウンロード センターのリンクをクリックします。<br>例：<br><img src="/blog/sharepoint-server/install-software-update/CU-download02.png"> </p></li><li><p>スタンドアロン の更新プログラム パッケージをダウンロードします。<br>例：<br><img src="/blog/sharepoint-server/install-software-update/CU-download03.png"></p></li></ol><blockquote><p><strong>NOTE</strong></p><ul><li>更新プログラムのダウンロード ボタン横にある言語選択は、更新プログラムに関わるものではなく、当該ページの表示言語を設定するものです。</li><li>更新プログラムのファイル (.exe、.cab ファイル等) は、更新プログラムの種類ごとに全て同じディレクトリに展開及び配置したうえで、適用をご実施ください。</li><li>既にインストールされている更新プログラムは、SharePoint サーバーの全体管理の アップグレードと移行 &gt; [製品および更新プログラムのインストール状態の確認] から確認できます。<br><img src="/blog/sharepoint-server/install-software-update/CU-download04.png"></li></ul></blockquote><h3 id="2-更新プログラムのインストール"><a href="#2-更新プログラムのインストール" class="headerlink" title="2. 更新プログラムのインストール"></a>2. 更新プログラムのインストール</h3><ol><li><p>すべての Web サーバー上でサービス 管理コンソール (services.msc) を起動し、World Wide Web 発行サービス (W3SVC) を停止してサーバー ファームからユーザーを切断します。<br><img src="/blog/sharepoint-server/install-software-update/CU-Install01.png" alt="サービス 管理コンソール"></p></li><li><p>サーバー ファーム内のすべての SharePoint サーバーに、更新プログラムをインストールします。</p><ul><li>更新プログラムをインストールするサーバーの順番は任意です。</li><li>言語に依存する更新プログラムと MUI / 言語パッチの両方をインストールする場合、インストールする順番は任意です。</li><li>インストール時に実行中のアプリケーションを閉じる必要があることを示すダイアログが表示された場合には、「セットアップの完了後、自動的にアプリケーションを閉じて再起動する」を選択して [OK] をクリックします。</li><li>更新されるモジュールの実行状況によっては、サーバーの再起動を求められる場合があります。その場合は、サーバーを再起動してください。</li></ul></li></ol><blockquote><p><strong>NOTE</strong></p><ul><li><strong>すべての SharePoint サーバーに更新プログラムの適用が完了するまでは、SharePoint Server 製品構成ウィザードを開始しないでください。</strong><ul><li>更新プログラムのインストール後に SharePoint 製品構成ウィザードが起動した場合には [キャンセル] をクリックします。</li></ul></li><li>SharePoint Server Subscription Edition の場合、更新プログラムのインストールに時間がかかる場合があります。<ul><li>弊社エンジニアの下記 Blog 記事にて、インストール時間を短縮するスクリプトをご紹介しています。<br>参照 : <a href="https://blog.stefan-gossner.com/2024/03/08/solving-the-extended-install-time-for-spse-cus/">Solving the extended install time for SPSE CUs – Stefan Goßner</a></li></ul></li></ul></blockquote><h3 id="3-SharePoint-製品構成ウィザードの実行"><a href="#3-SharePoint-製品構成ウィザードの実行" class="headerlink" title="3. SharePoint 製品構成ウィザードの実行"></a>3. SharePoint 製品構成ウィザードの実行</h3><p>SharePoint 製品構成ウィザードの実行は、すべての SharePoint サーバーに更新プログラムをインストールした後に実施してください。SharePoint 製品構成ウィザードの実行は、以下の順番での実施を推奨します。</p><ul><li>SharePoint サーバーの全体管理 Web サイトをホストするアプリケーション サーバー</li><li>他のアプリケーション サーバー (アプリケーション、分散キャッシュ、検索、カスタム)</li><li>フロントエンド サーバー</li></ul><p>サーバーの役割は、SharePoint サーバーの全体管理の システム設定 &gt; [このファームのサーバーの管理] から確認することができます。<br><img src="/blog/sharepoint-server/install-software-update/Config-wizard01.png"></p><ol><li><p>スタート メニューから SharePoint 製品構成ウィザード を起動します。<br>例：SharePoint Server Subscription Edition の場合<br><img src="/blog/sharepoint-server/install-software-update/Config-wizard02.png"></p></li><li><p>製品構成ウィザードの [SharePoint 製品へようこそ] ページで [次へ] をクリックします。<br><br><img src="/blog/sharepoint-server/install-software-update/Config-wizard03.png"> </p></li><li><p>下図のような、一部のサービスの再起動が必要になる可能性があることを通知するダイアログ ボックスが表示されますので、 [はい] をクリックします。<br><img src="/blog/sharepoint-server/install-software-update/Config-wizard04.png"></p></li><li><p>[SharePoint 製品構成ウィザードの終了] ページで [次へ] をクリックし、構成を実行します。<br><img src="/blog/sharepoint-server/install-software-update/Config-wizard05.png"> <br><br><img src="/blog/sharepoint-server/install-software-update/Config-wizard06.png"></p></li><li><p>構成が完了したら、[完了] をクリックして SharePoint 製品構成ウィザードを終了します。<br><img src="/blog/sharepoint-server/install-software-update/Config-wizard07.png"> </p></li><li><p>サービス 管理コンソール (services.msc) を起動し、World Wide Web 発行サービスの状態を確認します。</p><ul><li>状態が 「停止中」 の場合は手動で開始し、ユーザーが Web サーバーを使用できるようにします。</li><li>既に当該サービスが自動で開始されて状態が 「実行中」 の場合は、次の手順に進みます。</li></ul></li></ol><h3 id="4-適用の確認"><a href="#4-適用の確認" class="headerlink" title="4. 適用の確認"></a>4. 適用の確認</h3><ol><li><p>SharePoint サーバーの全体管理から、アップグレードと移行 &gt; [製品および更新プログラムのインストール状態の確認] を開きます。<br><img src="/blog/sharepoint-server/install-software-update/CU-confirm01.png"></p></li><li><p>適用した 更新プログラムが表示されていることを確認します。更新プログラムが単一かどうかにかかわらず、下図のように、言語に依存しない更新プログラムと MUI / 言語パッチの２つが確認できます。(言語パッチは、インストールされている SharePoint の Language Pack の言語に合わせてインストールされます)<br><br>例：日本語パック (1041 Language Pack) がインストールされている場合<br><img src="/blog/sharepoint-server/install-software-update/CU-confirm02.png"></p></li><li><p>SharePoint サーバーの全体管理から、システム設定 &gt; [このファームのサーバーの管理] を開きます。<br><img src="/blog/sharepoint-server/install-software-update/CU-confirm03.png"></p></li><li><p>インストールした更新プログラムのバージョンが、構成データベースのバージョンとなっていることを確認します。<br>例：SharePoint Server Subscription Edition の KB 5002651 の場合<br><img src="/blog/sharepoint-server/install-software-update/CU-confirm04.png"><br><img src="/blog/sharepoint-server/install-software-update/CU-confirm05.png"></p></li></ol><blockquote><p><strong>NOTE</strong><br>SharePoint 2016 では、更新プログラムを適用しても構成データベースのバージョンが更新されない場合がありますが、本手順 1 と 2 にて更新プログラムがインストールされていることが確認できれば問題ありません。</p></blockquote><br>今回の記事は以上となります。ご不明点等がありましたら、弊社サポート サービスまでお気軽にお問い合わせください。]]></content>
    
    
    <summary type="html">&lt;p&gt;本記事では、オンプレミスの SharePoint Server 製品に対する一般的な更新プログラムの適用手順を説明します。 &lt;br&gt;対象は、以下のオンプレミス環境です。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SharePoint Server Subscription Edition&lt;/li&gt;
&lt;li&gt;SharePoint Server 2019&lt;/li&gt;
&lt;li&gt;SharePoint Server 2016&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Microsoft 365 の SharePoint Online は対象外となりますのでご注意ください。 &lt;/p&gt;</summary>
    
    
    
    
    <category term="SharePoint Server" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Server/"/>
    
  </entry>
  
  <entry>
    <title>HAR ファイルの取得方法について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/how-to-get-har-file/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/how-to-get-har-file/</id>
    <published>2024-12-09T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.866Z</updated>
    
    <content type="html"><![CDATA[<p>本記事では、サポートへのお問い合わせ時に必要な情報をスムーズにご提供いただくことを目的として、HAR（HTTP Archive）ファイルの取得方法を説明します。</p><span id="more"></span><blockquote><p><strong>NOTE</strong></p><ul><li>本記事では Microsoft Edge での操作手順を説明します。</li><li>具体的な採取対象や手順は、お問い合わせ内容や事象によって異なる場合があります。<ul><li>本手順は基本的な参考資料としてご活用ください。</li><li>本記事の手順がすべての状況に適用されるわけではない点についてご了承ください。</li><li>追加の資料や手順が必要な際は、担当エンジニアが詳細をご案内いたします。</li></ul></li></ul></blockquote><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ul><li><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99">事前準備</a><ul><li><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99-1-%E6%99%82%E5%88%BB%E8%A1%A8%E7%A4%BA">事前準備 1</a></li><li><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99-2-%E9%96%8B%E7%99%BA%E8%80%85%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A">事前準備 2</a></li></ul></li><li><a href="#%E5%8F%96%E5%BE%97%E6%89%8B%E9%A0%86">取得手順</a><ul><li><a href="#1-%E9%8C%B2%E7%94%BB%E3%81%AE%E9%96%8B%E5%A7%8B">1.録画の開始</a></li><li><a href="#2-%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF-%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9-%E3%83%AD%E3%82%B0%E3%81%AE%E5%8F%96%E5%BE%97">2.ネットワーク トレース ログの取得</a></li><li><a href="#3-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%83%AD%E3%82%B0%E3%81%AE%E5%8F%96%E5%BE%97">3.コンソール ログの取得</a></li><li><a href="#4-%E9%8C%B2%E7%94%BB%E3%81%AE%E5%81%9C%E6%AD%A2">4.録画の停止</a></li><li><a href="#5-%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E8%A8%AD%E5%AE%9A%E3%82%92%E5%85%83%E3%81%AB%E6%88%BB%E3%81%99">5.事前準備設定を元に戻す</a></li></ul></li><li><a href="#%E5%8F%82%E8%80%83%E5%85%AC%E9%96%8B%E6%83%85%E5%A0%B1">参考公開情報</a></li></ul><p>HAR ファイルとは、ブラウザーの開発者ツールで取得するネットワーク トレース ログの保存ファイルです。ページの表示や各種操作で発生する ブラウザーとサイト間のやり取りをログとして記録します。<br>ネットワーク トレース データを取得する際には、同時に動画を取得いただくことがあります。これは、どのような操作をどのようなタイミングで行い、どのような画面や動きとなったのかを正確に把握するためです。<br>本記事では、HAR ファイル取得と同時に動画も取得いただく場合の手順を説明します。</p><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>必要に応じて、事前準備を実施します。</p><h3 id="事前準備-1-時刻表示"><a href="#事前準備-1-時刻表示" class="headerlink" title="事前準備 1 (時刻表示)"></a>事前準備 1 (時刻表示)</h3><p>事象発生の正確な時間を動画で把握するために、PowerShell 画面に秒単位の時刻を表示させておきます。<br>動画を取得する際は、この時刻が動画範囲に入るようにしてください。</p><ol><li><p>PowerShell を起動します（管理者権限は不要です）。</p></li><li><p>次のコマンドをコピーして実行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="variable">$true</span>) &#123;</span><br><span class="line">    <span class="built_in">Clear-Host</span></span><br><span class="line">    <span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;HH:mm:ss&quot;</span></span><br><span class="line">    <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/blog/sharepoint-online/how-to-get-har-file/ps-get-date01.png" alt="Get-Date コマンド入力例"></p></li><li><p>秒単位の時刻が PowerShell 上に表示されます。</p></li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/ps-get-date02.png" alt="Get-Date コマンド結果"></p><h3 id="事前準備-2-開発者ツールの設定"><a href="#事前準備-2-開発者ツールの設定" class="headerlink" title="事前準備 2 (開発者ツールの設定)"></a>事前準備 2 (開発者ツールの設定)</h3><ol><li>Microsoft Edge を起動します。</li><li>アドレスバーに “about:blank” と入力して空白ページを表示します。</li><li>ブラウザー上で [F12] キーを押します。Developer Tool が起動します。</li><li>画面右上の三点リーダーから設定を開きます。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/f12settings01.png" alt="F12 開発者ツール 設定"></p><ol start="5"><li>次の項目にチェックを入れます。</li></ol><p><strong>■ Edge のバージョン 130 以降を利用している場合</strong><br>セクション：ネットワーク<br>項目　　　：Allow to generate ‘HAR’ with sensitive data</p><p><img src="/blog/sharepoint-online/how-to-get-har-file/f12settings02.png" alt="F12 開発者ツール 基本設定"></p><p><strong>■ コンソール ログも取得する場合</strong><br>セクション：コンソール<br>項目　　　：タイムスタンプ / Timestamps</p><p><img src="/blog/sharepoint-online/how-to-get-har-file/f12settings03.png" alt="F12 開発者ツール コンソール設定"></p><ol start="6"><li>設定画面を右上の×ボタンで閉じた後、ブラウザーを終了します。</li></ol><blockquote><p><strong>補足</strong><br>Chromium 130 以降から、機密情報を含む可能性がある Cookie や Authorization ヘッダーの情報が、既定で HAR ファイルから除外されるようになりました。本設定をオンにすることで、Cookie や Authorization ヘッダーの情報を HAR ファイルにエクスポートできるようになります。</p></blockquote><h2 id="取得手順"><a href="#取得手順" class="headerlink" title="取得手順"></a>取得手順</h2><h4 id="1-録画の開始"><a href="#1-録画の開始" class="headerlink" title="1. 録画の開始"></a><u>1. 録画の開始</u></h4><p>Snipping Tool または PowerPoint を使って動画の録画を開始します。   </p><details><summary>Snipping Tool の場合（Windows 11 の場合のみ）</summary><ol><li>事象発生端末にて Snipping Tool を開きます。<br>スタート メニュー &gt; 検索バーで “Snipping” と入力しアプリを検索してください。</li><li>画面上部のビデオアイコンをクリックして、録画モードに変更します。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/snippingtool01.png" alt="Snipping Tool 録画モード"></p><ol start="3"><li>[＋新規] ボタンをクリックし、録画領域を選択します。<br>ブラウザー全体および PowerShell の時刻表示が確認できるよう範囲を選択してください。</li><li>[スタート] ボタンをクリックします。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/snippingtool02.png" alt="Snipping Tool 録画スタート ボタン"> </p></details><details><summary>PowerPoint の場合</summary><ol><li>事象発生端末にて PowerPoint を開き、新しいプレゼンテーションを選びます。</li><li>[挿入] タブ &gt; [メディア] &gt; [画面録画] ボタンをクリックします。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/ppt-recording01.png" alt="PowerPoint 録画ボタン1"> </p><ol start="3"><li>画面上部のメニューから [領域の選択] をクリックし、録画領域を選択します。<br>ブラウザー全体および PowerShell の時刻表示が確認できるよう範囲を選択してください。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/ppt-recording02.png" alt="PowerPoint 録画領域の選択"></p><ol start="4"><li>[録画] ボタンをクリックします。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/ppt-recording03.png" alt="PowerPoint 録画ボタン2"></p></details><blockquote><p><strong>NOTE</strong></p><ul><li>お使いのバージョンによって、若干メニューが異なる場合があります。</li><li>Windows 10 の Snipping Tool には録画機能がありません。Windows 10 の場合は PowerPoint をお使いください。</li></ul></blockquote><h4 id="2-ネットワーク-トレース-ログの取得"><a href="#2-ネットワーク-トレース-ログの取得" class="headerlink" title="2. ネットワーク トレース ログの取得"></a><u>2. ネットワーク トレース ログの取得</u></h4><ol><li>Microsoft Edge を起動します。</li><li>アドレスバーに “about:blank” と入力して空白ページを表示します。</li><li>ブラウザー上で [F12] キーを押し、開発者ツールを起動します。</li><li>[ネットワーク / Network ] タブを選択します。</li><li>[ログの保持 / Preserve log] [キャッシュを無効にする / Disable cache] にチェックを入れます。</li><li>[フィルター] アイコンをクリックしてフィルターメニューを表示し、[すべて / All] を選択します。</li><li>[ネットワーク ログのクリア] アイコンをクリックします。</li><li>[ネットワーク ログの記録] アイコンがアクティブ（赤色）になっていることを確認します。<ul><li>赤色は記録が開始されていることを示します</li><li>ボタンがグレーの場合は記録が停止していますので、ボタンをクリックしてアクティブ（赤色）にしてください</li></ul></li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/networktrace01.png" alt="ネットワーク トレース ログの取得"></p><ol start="9"><li>開発者ツールを開いているタブ上で事象が発生するサイトにアクセスし、事象を再現します。</li><li>事象の再現が完了したら、[ネットワーク ログの記録] アイコンをクリックして記録を停止します。</li><li>[HAR のエクスポート] アイコンを長押しします。</li><li>[HAR のエクスポート (機密データを含む) / Export HAR (With sensitive data)] を選択します。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/networktrace02.png" alt="Export HAR file "></p><ol start="13"><li>任意の場所に HAR ファイルを保存します。</li></ol><blockquote><p><strong>NOTE</strong></p><ul><li>別のタブでアクセスするとログが記録されません。</li><li>タブが遷移する事象はログを記録できない場合があります。</li><li>[HAR のエクスポート (機密データを含む)] を選択することで、Cookie や Authorization ヘッダーの情報を HAR ファイルにエクスポートできます。</li><li>長押しで当該メニューが表示されない場合、事前準備２を実施していない可能性があります。設定を確認の上、もう一度、ログを採取し直してください。</li></ul></blockquote><h4 id="3-コンソールログの取得"><a href="#3-コンソールログの取得" class="headerlink" title="3. コンソールログの取得"></a><u>3. コンソールログの取得</u></h4><p>コンソール ログを採取することで、JavaScript などのクライアント サイド スクリプトのエラーを確認することができます。</p><ol><li>開発者ツール画面上部の [コンソール] タブを選択します。</li><li>コンソール内に、事象の再現中に出力されたエラー、警告、または情報メッセージが記録されていることを確認します。</li><li>コンソール内を右クリックし、[名前を付けて保存… / Save as]を選択します。<br>任意の場所にコンソール ログをテキスト形式で保存します。<br><br><img src="/blog/sharepoint-online/how-to-get-har-file/consolelog.png" alt="コンソール ログの保存 "></li></ol><h4 id="4-録画の停止"><a href="#4-録画の停止" class="headerlink" title="4. 録画の停止"></a><u>4. 録画の停止</u></h4><p>録画を停止します。</p><details><summary>Snipping Tool の場合</summary><ol><li>画面上部の録画停止ボタンをクリックします。</li></ol><p><img src="/blog/sharepoint-online/how-to-get-har-file/snippingtool03.png" alt="Snipping Tool の録画停止ボタン"><br>2. 動画ファイルは既定では自動保存されます。<br>保存場所は、画面右上の三点リーダー […] ＞設定から [画面録画の保存先] をご確認ください。<br><br><img src="/blog/sharepoint-online/how-to-get-har-file/snippingtool04.png" alt="Snipping Tool のデータ保存場所の確認"> </p></details><details><summary>PowerPoint の場合</summary><ol><li>画面上部の停止ボタンをクリックします。<br><br><img src="/blog/sharepoint-online/how-to-get-har-file/ppt-recording04.png" alt="PowerPoint 録画停止ボタン"> </li><li>スライドに動画が貼り付けられますので、PowerPoint ファイルを任意の場所に保存します。</details></li></ol><h4 id="5-事前準備設定を元に戻す"><a href="#5-事前準備設定を元に戻す" class="headerlink" title="5. 事前準備設定を元に戻す"></a><u>5. 事前準備設定を元に戻す</u></h4><ol><li>事前準備 1 で起動した PowerhSell を × ボタンで閉じます。</li><li>事前準備 2 で 「HAR (センシティブ データを含む) の生成を許可する / Allow to genarate ‘HAR’ with sensitive data」にチェックを入れた場合は、HAR ファイル取得後にチェックをオフにします。</li></ol><p>手順は以上となります。<br><br></p><h2 id="参考公開情報"><a href="#参考公開情報" class="headerlink" title="参考公開情報"></a>参考公開情報</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/azure-web-pubsub/howto-troubleshoot-network-trace#collect-a-network-trace-in-the-browser-browser-based-apps-only">ネットワーク トレースの収集方法 | Microsoft Learn</a><br><a href="https://learn.microsoft.com/ja-jp/azure/azure-portal/capture-browser-trace">トラブルシューティングのためにブラウザー トレースをキャプチャする - Azure portal | Microsoft Learn</a></p><p>取得した HAR ファイルおよび動画ファイルは、サポート エンジニアからご案内させていただく保存先へ格納してください。<br>本記事に関するご不明点、疑問点などがありましたら、お問い合わせ担当のサポート エンジニアまでお問い合わせください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;本記事では、サポートへのお問い合わせ時に必要な情報をスムーズにご提供いただくことを目的として、HAR（HTTP Archive）ファイルの取得方法を説明します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>(MC714186) カスタム スクリプトのブロックによる影響について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/impact-of-custom-script-block/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/impact-of-custom-script-block/</id>
    <published>2024-09-01T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.869Z</updated>
    
    <content type="html"><![CDATA[<p>この投稿では、Microsoft 365 管理センターのメッセージ センターに MC714186 として掲載されている、SharePoint Online のカスタム スクリプトの無効化について記載します。<br>多くの場合はカスタム スクリプトのブロックによる既存スクリプトへの影響はありませんが、特定の SharePoint Framework ソリューション（requiresCustomScript プロパティが True に設定されたソリューション）をご利用の場合は、影響を受ける可能性がありますのでご確認ください。<br>※カスタム スクリプトのブロックに関する最新の情報は、メッセージ センターにて MC714186 をご確認ください。</p><span id="more"></span><h2 id="カスタム-スクリプトのブロックの概要"><a href="#カスタム-スクリプトのブロックの概要" class="headerlink" title="カスタム スクリプトのブロックの概要"></a>カスタム スクリプトのブロックの概要</h2><p>SharePoint サイトでは、管理者がカスタム スクリプトの実行を許可することで、ページへのスクリプトの追加や、スクリプトが含まれるファイルのアップロード、ソリューションの追加など、柔軟にサイトをカスタマイズできるようになります。(※1)<br>しかしながら、サイトの編集権限を持つ一般ユーザーが容易にスクリプトを常時追加できるようになるため、悪意のあるスクリプトが挿入されるなどのセキュリティへの注意が必要です。(※2)<br>このようなセキュリティ リスクを軽減するため、今後(※3)は一部のテンプレートを除くすべてのサイト(※4)で、カスタム スクリプトの編集が自動的にブロックされるように変更されます。<br>サイトへのスクリプトの追加、変更、または削除が必要となった場合は、テナント管理者がサイトのカスタム スクリプトを一時的に許可（有効化）することで、以前と同様にスクリプトを追加することができます。<br>カスタム スクリプトの有効化後は、24 時間以内に再び自動で無効化されます。セキュリティ強化を目的として、スクリプトの追加完了後に管理者が手動で無効化に戻すことも可能です。</p><p>(※1) <a href="https://learn.microsoft.com/ja-jp/sharepoint/allow-or-prevent-custom-script#features-affected-when-custom-script-is-blocked">カスタム スクリプトを許可または禁止する - SharePoint in Microsoft 365 | Microsoft Learn</a>  </p><p>(※2) <a href="https://learn.microsoft.com/ja-jp/sharepoint/security-considerations-of-allowing-custom-script">カスタム スクリプトを許可する場合のセキュリティに関する考慮事項 - SharePoint in Microsoft 365 | Microsoft Learn</a></p><p>(※3) カスタム スクリプトの無効化は、2024 年 4 月下旬に開始され、5 月上旬までに完了する予定です。最新の展開状況は<a href="https://admin.microsoft.com/Adminportal/Home#/MessageCenter/:/messages/MC714186">メッセージ センターの MC714186</a> をご確認ください。</p><p>(※4) カスタム スクリプトの無効化は、以下のサイト テンプレートを除くすべての既存の SharePoint サイトと OneDrive サイトに適用されます。</p><p>BLANKINTERNETCONTAINER#0 = 従来の発行ポータル サイト<br>CMSPUBLISHING#0 = 公開サイト<br>BLANKINTERNET#0 = 発行サイト<br><del>GROUP#0 = チーム サイト</del><br>APPCATALOG#0 = アプリ・カタログ<br>CSPCONTAINER#0 = CSP コンテナー  </p><p>※ 2024 年 8 月 28 日 更新<br>カスタム スクリプトの無効化の対象外のサイト テンプレートから「GROUP#0 = チーム サイト」が除外されました。<br>「GROUP#0 = チーム サイト」は MC714186 の変更によりカスタム スクリプトが無効化されます。</p><h2 id="注意事項-例外"><a href="#注意事項-例外" class="headerlink" title="注意事項 (例外)"></a>注意事項 (例外)</h2><p>カスタム スクリプトのブロック後も、OneDrive サイトと SharePoint サイトの既存ページのスクリプトの実行は一般的に影響を受けません。<br>しかしながら、SharePoint Framework ソリューションにおいて、マニフェストで requiresCustomScript プロパティを True に設定している場合、カスタム スクリプトのブロックによりソリューションが動作しなくなることを確認しております。requiresCustomScript プロパティが True に設定されているソリューションの一例として、PnP の Modern Script Editor Web Part (<a href="https://github.com/pnp/sp-dev-fx-webparts/blob/main/samples/react-script-editor/README.md">https://github.com/pnp/sp-dev-fx-webparts/blob/main/samples/react-script-editor/README.md</a>) があります。<br><del>requiresCustomScript プロパティが True に設定された SharePoint Framework ソリューションをご利用の場合は、ブロックの期限が迫っておりますので、カスタム スクリプトの無効化適用をあらかじめ延長することをご検討くださいますようお願いいたします。</del></p><p>※ 2024 年 11 月 19 日 更新<br>カスタム スクリプトの無効化の延長は 2024 年 11 月中旬までとなります。requiresCustomScript プロパティが True に設定された SharePoint Framework ソリューションをご利用の場合は、requiresCustomScript プロパティを Flase に変更してソリューションを再追加するか、ソリューション利用時のみ一時的にカスタム スクリプトを有効化することをご検討くださいますようお願いいたします。</p><p><del>なお、この問題については、2024 年 4 月 10 日現在、開発部門にて調査が進められております。調査の進展があり次第、本記事を更新いたします。</del></p><p>※ 2024 年 9 月 2 日 更新<br>上記は製品の想定動作であり、今後、カスタム スクリプトがブロックされているサイトでは、requiresCustomScript プロパティが True に設定されている SharePoint Framework ソリューションは動作しませんので、ご留意ください。<br>この内容は以下の公開情報にも掲載されています。<br><a href="https://learn.microsoft.com/ja-jp/sharepoint/allow-or-prevent-custom-script#features-affected-when-custom-script-is-blocked">カスタム スクリプトを許可または禁止する - SharePoint in Microsoft 365 | Microsoft Learn</a></p><p>(*) requiresCustomScript プロパティの設定例が掲載された公開情報<br><a href="https://learn.microsoft.com/en-us/sharepoint/dev/spfx/web-parts/get-started/build-a-hello-world-web-part#web-part-manifest">https://learn.microsoft.com/en-us/sharepoint/dev/spfx/web-parts/get-started/build-a-hello-world-web-part#web-part-manifest</a></p><h2 id="カスタム-スクリプトの無効化の延長について"><a href="#カスタム-スクリプトの無効化の延長について" class="headerlink" title="カスタム スクリプトの無効化の延長について"></a>カスタム スクリプトの無効化の延長について</h2><p><del>カスタム スクリプトの無効化を遅らせるための SharePoint 管理シェル コマンド DelayDenyAddAndCustomizePagesEnforcement が 4 月中旬までに展開されます。</del><br><del>SharePoint 管理者もしくは全体管理者で以下のコマンドを実行することで、カスタム スクリプトの無効化を 2024 年 11 月中旬まで遅らせることが可能です。</del></p><!-- ``` PowerShell --><p><del>Set-SPOTenant -DelayDenyAddAndCustomizePagesEnforcement $True</del></p><!-- ``` --><p>※ 2024 年 11 月 19 日 更新<br>カスタム スクリプトの無効化を遅らせるための SharePoint 管理シェル コマンド DelayDenyAddAndCustomizePagesEnforcement による延長は 2024 年 11 月中旬までとなります。以降は、カスタム スクリプトの有効化後、24 時間経過後に再び自動で無効化されます。</p><p>今回の投稿は以上です。<br>不明な点などがありましたら、弊社サポートサービスまでお気軽にお問い合わせください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;この投稿では、Microsoft 365 管理センターのメッセージ センターに MC714186 として掲載されている、SharePoint Online のカスタム スクリプトの無効化について記載します。&lt;br&gt;多くの場合はカスタム スクリプトのブロックによる既存スクリプトへの影響はありませんが、特定の SharePoint Framework ソリューション（requiresCustomScript プロパティが True に設定されたソリューション）をご利用の場合は、影響を受ける可能性がありますのでご確認ください。&lt;br&gt;※カスタム スクリプトのブロックに関する最新の情報は、メッセージ センターにて MC714186 をご確認ください。&lt;/p&gt;</summary>
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>Windows 365 カスタム イメージの作成方法</title>
    <link href="https://jpspsupport.github.io/blog/windows-365/create-custom-image/"/>
    <id>https://jpspsupport.github.io/blog/windows-365/create-custom-image/</id>
    <published>2024-07-02T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.887Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Windows 365 の過去のサポート ブログ記事は、<a href="https://jpmem.github.io/blog/tags/Windows-365/">こちらから</a>ご覧ください。</p></blockquote><p>本記事では、Windows 365 クラウド PC のカスタム イメージ作成方法について記載します。<br>Windows 365 では、イメージを作成してカスタム イメージとして Intune にアップロードし、クラウド PC のプロビジョニングに使用することが可能です。イメージ元には、Azure Virtual Machine (以下、Azure VM) または Hyper-V 上の仮想マシンを使用します。</p><span id="more"></span><h3 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h3><ol><li><a href="#1-%E7%95%99%E6%84%8F%E7%82%B9">留意点</a></li><li><a href="#2-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E4%BD%9C%E6%88%90%E6%89%8B%E9%A0%86">カスタム イメージ作成手順</a></li><li><a href="#3-%E8%A3%9C%E8%B6%B3">補足</a></li></ol><h2 id="1-留意点"><a href="#1-留意点" class="headerlink" title="1. 留意点"></a>1. 留意点</h2><hr><p>カスタムイメージの作成には、いくつかの留意点があります。</p><ul><li>Windows 365 イメージ要件を満たしている</li><li>イメージを 仮想デスクトップ インフラストラクチャ (VDI) 用のロールに最適化する</li><li>Teams アプリを最適化する</li><li>トラステッド プラットフォーム モジュール (TPM) 起動が有効である</li><li>Windows 更新プログラムのインストールが完了している</li></ul><p>それぞれについて解説していきます。</p><h5 id="Windows-365-イメージ要件を満たしている"><a href="#Windows-365-イメージ要件を満たしている" class="headerlink" title="- Windows 365 イメージ要件を満たしている"></a>- Windows 365 イメージ要件を満たしている</h5><p>Intune にカスタム イメージがアップロードされる際には、そのイメージが Windows 365 のイメージ要件を満たしているかどうか、仮想マシンがデプロイされクラウド PC としてプロビジョニングおよび起動が可能かどうかの検証チェックが行われます。</p><p>Windows 365 のイメージ要件については、以下の公開情報をご参照ください。  </p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/device-images#image-requirements">イメージの要件 - デバイス イメージの概要 | Windows 365 Enterprise</a></p></blockquote><h5 id="イメージを-仮想デスクトップ-インフラストラクチャ-VDI-用のロールに最適化する"><a href="#イメージを-仮想デスクトップ-インフラストラクチャ-VDI-用のロールに最適化する" class="headerlink" title="- イメージを 仮想デスクトップ インフラストラクチャ (VDI) 用のロールに最適化する"></a>- イメージを 仮想デスクトップ インフラストラクチャ (VDI) 用のロールに最適化する</h5><p>Windows 365 のカスタム イメージで最適なパフォーマンスを得るためには、イメージを仮想デスクトップ ロール用に最適化する必要があります。イメージ元マシンに ISO イメージファイルまたは Windows 365 のギャラリーイメージ以外のものを使用する場合は、最適化が必要です。Windows 365 のギャラリー イメージは最適化が構成されているため対応は不要です。</p><p>Windows 365 のギャラリー イメージについては、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/device-images#gallery-images">ギャラリー イメージ - デバイス イメージの概要 | Windows 365 Enterprise</a></p></blockquote><p>仮想デスクトップ ロール用のイメージ最適化は、Github で公開されている <a href="https://github.com/The-Virtual-Desktop-Team/Virtual-Desktop-Optimization-Tool/tree/main">Virtual Desktop Optimization Tool (VDOT)</a> をご利用ください。</p><p>また、弊社エンジニアが 仮想マシンの最適化について解説しているこちらの動画も参考にご紹介させていただきます。</p><blockquote><p><a href="https://www.youtube.com/watch?v=Cx1eJq5xsIM">Episode 6: Performance Optimizations for Windows Virtual Desktop with Robert and Tim (aka VDI Guys)</a></p></blockquote><h5 id="Teams-アプリを最適化する"><a href="#Teams-アプリを最適化する" class="headerlink" title="- Teams アプリを最適化する"></a>- Teams アプリを最適化する</h5><p>Windows 365 クラウド PC で使用する Teams アプリは最適化されている必要があります。イメージ元マシンに Microsoft 365 App が含まれない Windows 365 ギャラリー イメージ または ISO イメージファイルを使用する場合は、別途 Teams アプリの最適化を実施してください。</p><p>なお、クラウド PC には Microsoft 365 App に含まれる 最新の Microsoft Teams をインストールする必要があります。Microsoft ストア等から入手可能なデスクトップ アプリをインストールすることはできませんので、Intune から Microsoft 365 App + Teams アプリを配布することをお勧めいたします。</p><p>上記に関する詳細は、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/teams-on-cloud-pc">クラウド PC 用 Microsoft Teams | Windows 365 Enterprise</a><br>　　　<a href="https://learn.microsoft.com/ja-jp/microsoftteams/teams-for-vdi">仮想化デスクトップ インフラストラクチャ用クラシック Teams | Microsoft Teams</a><br>　　　<a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/create-custom-image-support-teams">Microsoft Teams をサポートするカスタムのクラウド PC イメージを作成する | Windows 365 Enterprise</a></p></blockquote><h5 id="トラステッド-プラットフォーム-モジュール-TPM-起動が有効である"><a href="#トラステッド-プラットフォーム-モジュール-TPM-起動が有効である" class="headerlink" title="- トラステッド プラットフォーム モジュール (TPM) 起動が有効である"></a>- トラステッド プラットフォーム モジュール (TPM) 起動が有効である</h5><p>Windows 365 のクラウド PC においては、トラステッド プラットフォーム モジュール起動 (以下、TPM 起動) が有効化されています。TPM 起動は Windows 11 のハードウェア要件で、Windows 10 においてはその限りでありませんが、Windows 11 へのアップデートなどを踏まえて Windows 365 のクラウド PC では Windows 10 においても TPM 起動が有効化されます。そのため、カスタム イメージにおいても TPM 起動の有効化をお願いしています。</p><p>本記事でご紹介している作成方法は、それぞれで TPM 起動を有効化するタイミングが異なります。</p><p>Azure VM で作成する場合は、作成時に TPM 起動か Standard 起動かを選択することができます。Standard 起動の Azure VM から作成したイメージは、Intune にカスタム イメージとしてアップロードする際に自動的に TPM 起動が有効化されますが、クラウド PC のプロビジョニング後にクラウド PC の再起動が必要となります。</p><p>イメージを Hyper-V の仮想マシンから作成する場合は、仮想マシンに OS をインストールする前に TPM 起動を有効にする必要があります。 (Windows 11 の場合は、TPM 起動が無効の状態では OS インストールのプロセスに進むことができません)</p><p>Windows 11 のシステム要件、仮想マシンのサポート要件については、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows/whats-new/windows-11-requirements">Windows 11 の要件 | Windows</a></p></blockquote><h5 id="Windows-更新プログラムのインストールが完了している"><a href="#Windows-更新プログラムのインストールが完了している" class="headerlink" title="- Windows 更新プログラムのインストールが完了している"></a>- Windows 更新プログラムのインストールが完了している</h5><p>カスタムイ メージのアップロードの際にプロビジョニングの検証チェックが実行されますが、その際に誤って再起動が発生しないようにするために、すべての Windows 更新プログラムのインストールを完了させ、仮想マシンを再起動して適用が必要な更新プログラムがないことを確認してください。これはクラウド PC に限らず、仮想マシンのプロビジョニングにおいても共通です。</p><p>当該事項については、以下の公開情報をご参照ください。 </p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/prepare-for-upload-vhd-image#install-windows-updates">Windows 更新プログラムのインストール - Azure にアップロードする Windows VHD または VHDX を準備する | Azure Virtual Machines</a></p></blockquote><h2 id="2-カスタム-イメージ作成手順"><a href="#2-カスタム-イメージ作成手順" class="headerlink" title="2. カスタム イメージ作成手順"></a>2. カスタム イメージ作成手順</h2><hr><h3 id="目次-1"><a href="#目次-1" class="headerlink" title="目次"></a>目次</h3><ul><li><a href="#%E4%BD%9C%E6%88%90%E6%96%B9%E6%B3%95%E3%81%AE%E6%AF%94%E8%BC%83">作成方法の比較</a></li><li><a href="#%E4%BD%9C%E6%88%90%E6%96%B9%E6%B3%95">作成方法</a><ul><li><a href="https://jpspsupport.github.io/blog/windows-365/create-custom-image/#%E6%96%B9%E6%B3%95-1-Azure-Virtual-Machine-Standard-%E8%B5%B7%E5%8B%95-%E3%81%A7%E4%BD%9C%E6%88%90">方法 1. Azure Virtual Machine (Standard 起動) で作成</a>   </li><li><a href="https://jpspsupport.github.io/blog/windows-365/create-custom-image/#%E6%96%B9%E6%B3%95-2-Hyper-V-%E3%81%AE%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3%E3%81%A7%E4%BD%9C%E6%88%90">方法 2. Hyper-V の仮想マシンで作成</a></li><li><a href="https://jpspsupport.github.io/blog/windows-365/create-custom-image/#%E7%95%AA%E5%A4%96%E7%B7%A8-Azure-Virtual-Machine-%E3%83%88%E3%83%A9%E3%82%B9%E3%83%86%E3%83%83%E3%83%89%E8%B5%B7%E5%8B%95-%E3%81%A7%E4%BD%9C%E6%88%90">番外編. Azure Virtual Machine (トラステッド起動) で作成</a></li></ul></li></ul><h3 id="作成方法の比較"><a href="#作成方法の比較" class="headerlink" title="作成方法の比較"></a>作成方法の比較</h3><p><img src="/blog/windows-365/create-custom-image/compare.png"><br>※ Microsoft 365 Apps を含むギャラリー イメージ を使用する場合は不要</p><h4 id="作成方法"><a href="#作成方法" class="headerlink" title="作成方法"></a>作成方法</h4><details><summary>方法 1. Azure Virtual Machine (Standard 起動) で作成</summary><h3 id="方法-1-Azure-Virtual-Machine-Standard-起動-で作成"><a href="#方法-1-Azure-Virtual-Machine-Standard-起動-で作成" class="headerlink" title="方法 1. Azure Virtual Machine (Standard 起動) で作成"></a>方法 1. Azure Virtual Machine (Standard 起動) で作成</h3><p>手順 1. Standard 起動の仮想マシンを作成しカスタマイズする<br>手順 2. キャプチャしてマネージド イメージを作成する<br>手順 3. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする<br>手順 4. クラウド PC を再起動して TPM 起動を有効化する</p><h4 id="手順-1-Standard-起動の仮想マシンを作成しカスタマイズする"><a href="#手順-1-Standard-起動の仮想マシンを作成しカスタマイズする" class="headerlink" title="手順 1. Standard 起動の仮想マシンを作成しカスタマイズする"></a>手順 1. Standard 起動の仮想マシンを作成しカスタマイズする</h4><p>1 ) Azure portal の [Virtual Machine] サービスにアクセスし、 [+作成] &gt; [Azure 仮想マシン] を選択します。</p><p><img src="/blog/windows-365/create-custom-image/2-1-1.png"></p><p>2 ) 必要なフィールドを入力し、Azure 仮想マシンを作成します。</p><ul><li>セキュリティの種類は [Standard 起動の仮想マシン] を選択します</li><li>イメージは、Windows 365 クラウド PC 用のギャラリー イメージの使用を推奨します (<a href="#1-%E7%95%99%E6%84%8F%E7%82%B9">留意点</a> をご参照ください)<br>※ 選択項目下の [すべてのイメージを表示] リンクから Windows 365 Cloud PC image template が選択できます。</li></ul><p><img src="/blog/windows-365/create-custom-image/2-1-2.png"></p><p>3 ) 仮想マシンが作成されたら、必要に応じてイメージや Teams の最適化、アプリケーションのインストール、Windows の更新プログラムの適用等を実施します。(<a href="#1-%E7%95%99%E6%84%8F%E7%82%B9">留意点</a> をご参照ください)</p><p>4 ) 一般化されたイメージを作成するために sysprep を実行し、仮想マシンをシャットダウンします。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/prepare-for-upload-vhd-image#generalize-a-vhd">VHD の一般化 - Azure にアップロードする Windows VHD または VHDX を準備する | Azure Virtual Machines</a></p></blockquote><p>5 ) 仮想マシンを停止します。</p><p><img src="/blog/windows-365/create-custom-image/2-1-3.png"></p><h4 id="手順-2-キャプチャしてマネージド-イメージを作成する"><a href="#手順-2-キャプチャしてマネージド-イメージを作成する" class="headerlink" title="手順 2. キャプチャしてマネージド イメージを作成する"></a>手順 2. キャプチャしてマネージド イメージを作成する</h4><p>1 ) [キャプチャ] を選択します。</p><p><img src="/blog/windows-365/create-custom-image/2-1-4.png"></p><p>2 ) イメージの作成画面において、 [Azure コンピューティング ギャラリーにイメージを共有する] で [いいえ、マネージド イメージのみをキャプチャします。] を選択します。その他必要な項目を選択し、[確認および作成] をクリックしてイメージを作成します。</p><p><strong>※ Windows 365 のカスタム イメージは、マネージド イメージをサポートしています。</strong><br><strong>そのため、[はい、ギャラリーに VM イメージ バージョンとして共有します。] を選択してしまうと、Intune にカスタム イメージをアップロードする際に、作成したイメージが読み込まれませんのでご注意ください。</strong></p><p><img src="/blog/windows-365/create-custom-image/2-1-5.png"></p><h4 id="手順-3-マネージド-イメージをクラウド-PC-のカスタム-イメージとして-Intune-にアップロードする"><a href="#手順-3-マネージド-イメージをクラウド-PC-のカスタム-イメージとして-Intune-にアップロードする" class="headerlink" title="手順 3. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする"></a>手順 3. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする</h4><p>手順については、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/add-device-images#add-a-custom-device-image">カスタム デバイス イメージを追加する - カスタム デバイス イメージを追加または削除する | Windows 365 Enterprise</a></p></blockquote><p>※ カスタム イメージのアップロードには、約１～2時間程かかる場合があります。<br>※ アップロードのステータスは、通知領域または [カスタム イメージ] タブ の一覧から確認することができます。</p><h4 id="手順-4-クラウド-PC-を再起動して-TPM-起動を有効化する"><a href="#手順-4-クラウド-PC-を再起動して-TPM-起動を有効化する" class="headerlink" title="手順 4. クラウド PC を再起動して TPM 起動を有効化する"></a>手順 4. クラウド PC を再起動して TPM 起動を有効化する</h4><p>Standard 起動の仮想マシンからイメージを作成した場合、前手順のアップロードで自動的に TPM 起動が有効なカスタム イメージが作成されますが、TPM 起動を完全に有効化するためには、クラウド PC のプロビジョニング後にクラウド PC を再起動する必要があります。</p><p>再起動させるタイミングは運用状況によって色々なパターンがあるかと思いますが、ここではクラウド PC をユーザーに展開する前に、対象のクラウド PC を一括で再起動させる方法をご紹介します。</p><p>1 ) クラウド PC をプロビジョニングします。詳細は以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/create-provisioning-policy">プロビジョニング ポリシーを作成する | Windows 365 Enterprise</a></p></blockquote><p>2 ) Intune から指定したすべてのクラウド PCに対して再起動を実行します。</p><p>一括操作の手順およびリモートでの再起動については、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/mem/intune/remote-actions/bulk-device-actions">デバイスの一括アクションを使用する | Intune サービス</a><br>　　　<a href="https://learn.microsoft.com/ja-jp/mem/intune/remote-actions/device-restart">Intune でデバイスをリモートで再起動する | Intune サービス</a></p></blockquote><p>3 ) 再起動後、クラウド PC の TPM 起動が有効となります。状態は、tpm.msc からご確認いただけます。</p><p># プロビジョニング直後の TPM 管理画面<br><img src="/blog/windows-365/create-custom-image/2-1-6.png"></p><p># 再起動後の TPM 管理画面<br><img src="/blog/windows-365/create-custom-image/2-1-7.png"></p></details><details><summary>方法 2. Hyper-V の仮想マシンで作成</summary><h3 id="方法-2-Hyper-V-の仮想マシンで作成"><a href="#方法-2-Hyper-V-の仮想マシンで作成" class="headerlink" title="方法 2. Hyper-V の仮想マシンで作成"></a>方法 2. Hyper-V の仮想マシンで作成</h3><p>手順 1. 仮想マシンを作成しカスタマイズする<br>手順 2. VHDX ファイルを VHD 容量固定ファイルに変換する<br>手順 3. VHD ファイルをローカルから Azure ストレージ アカウントにアップロードする<br>手順 4. Azure イメージ サービスを使用して VHD ファイルからマネージド イメージを作成する<br>手順 5. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする</p><h4 id="手順-1-仮想マシンを作成しカスタマイズする"><a href="#手順-1-仮想マシンを作成しカスタマイズする" class="headerlink" title="手順 1. 仮想マシンを作成しカスタマイズする"></a>手順 1. 仮想マシンを作成しカスタマイズする</h4><p>1 ) Hyper-V マネージャーで仮想マシンを新規作成します。この際、システム要件に沿って仮想マシンの世代は [第 2 世代] (Gen 2) を選択します。</p><p><img src="/blog/windows-365/create-custom-image/2-2-1.png"></p><p>2 ) 仮想マシン作成後、設定のセキュリティ画面を開き [トラステッド プラットフォーム モジュールを有効にする] にチェックを入れます。<br>※ 本操作を行わない場合、Windows 11 においては ISO ファイル読み込み後の OS セットアップでシステム要件を満たすよう求められます。</p><p><img src="/blog/windows-365/create-custom-image/2-2-2.png"></p><p>3 ) ISO イメージファイルを用いて OS のセットアップを行い、イメージや Teams の最適化、アプリケーションのインストール、Windows の更新プログラムの適用等を実施します。 (<a href="#1-%E7%95%99%E6%84%8F%E7%82%B9">留意点</a> をご参照ください)</p><p>4 ) 一般化されたイメージを作成するために sysprep を実行し、仮想マシンをシャットダウンします。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/prepare-for-upload-vhd-image#generalize-a-vhd">VHD の一般化 - Azure にアップロードする Windows VHD または VHDX を準備する | Azure Virtual Machines</a></p></blockquote><p>5 ) チェックポイントが存在する場合は、チェックポイントを削除します。<br>　<strong>※ チェックポイントが存在する状態の VHDX を使用すると、Intune へのカスタム イメージ アップロードに失敗します。</strong></p><h4 id="手順-2-VHDX-ファイルを-VHD-容量固定ファイルに変換する"><a href="#手順-2-VHDX-ファイルを-VHD-容量固定ファイルに変換する" class="headerlink" title="手順 2. VHDX ファイルを VHD 容量固定ファイルに変換する"></a>手順 2. VHDX ファイルを VHD 容量固定ファイルに変換する</h4><p>作成した仮想マシンのディスクは VHDX 形式のため、VHD 形式に変換する必要があります。<br>変換前にディスクを最適化し、変換時にディスクの容量を固定化します。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/device-images-convert-generation-2#convert-the-disk-to-a-fixed-size-and-vhd-format">ディスクを固定サイズと VHD 形式に変換する - 既存のカスタム デバイス イメージを第 2 世代の仮想マシンに変換する | Windows 365 Enterprise</a></p></blockquote><p>1 ) Hyper-V マネージャーで [ディスクの編集] を開き、[ディスクの場所] ページで手順 1. で作成した仮想マシンの VHDX を選択します。</p><p><img src="/blog/windows-365/create-custom-image/2-2-3.png"></p><p>2 ) [操作の選択] ページで [最適化] を選択し、[完了] をクリックします。</p><p><img src="/blog/windows-365/create-custom-image/2-2-4.png"></p><p>3 ) 再度、[ディスクの編集] 画面を開き対象の VHDX ファイルを選択します。</p><p>4 ) [操作の選択] ページで [変換] を選択し、 [次へ] をクリックします。</p><p><img src="/blog/windows-365/create-custom-image/2-2-5.png"></p><p>5 ) 下図の画面で次のとおり選択し、任意の VHD 容量固定ファイル名と保存場所を選択して、[完了] をクリックします。</p><ul><li>[ディスクフォーマットの選択] : VHD</li><li>[ディスクの種類の選択] : 容量固定</li></ul><p><img src="/blog/windows-365/create-custom-image/2-2-6.png"></p><h4 id="手順-3-VHD-ファイルをローカルから-Azure-ストレージ-アカウントにアップロードする"><a href="#手順-3-VHD-ファイルをローカルから-Azure-ストレージ-アカウントにアップロードする" class="headerlink" title="手順 3. VHD ファイルをローカルから Azure ストレージ アカウントにアップロードする"></a>手順 3. VHD ファイルをローカルから Azure ストレージ アカウントにアップロードする</h4><p>Azure Storage Explorer を使用して (推奨)、ローカルの VHD ファイルを Azure ストレージ アカウントの Blob コンテナーにアップロードします。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/device-images-convert-generation-2#upload-the-converted-vhd-to-azure">変換された VHD を Azure にアップロードします - 既存のカスタム デバイス イメージを第 2 世代の仮想マシンに変換する | Windows 365 Enterprise</a></p></blockquote><blockquote><p><strong>事前準備：</strong> ストレージ アカウントを作成し、<a href="https://azure.microsoft.com/en-us/products/storage/storage-explorer/">Azure Storage Explorer</a> をインストールします。<br>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/storage/common/storage-account-create?tabs=azure-portal">Azure Storage アカウントを作成する | Azure ストレージ</a></p></blockquote><p>1 ) Azure Storage Explorer を起動し、対象のストレージ アカウントのコンテナーに VHD ファイルをアップロードします。</p><p><img src="/blog/windows-365/create-custom-image/2-3-1.png"></p><h4 id="手順-4-Azure-イメージ-サービスを使用して-VHD-ファイルからマネージド-イメージを作成する"><a href="#手順-4-Azure-イメージ-サービスを使用して-VHD-ファイルからマネージド-イメージを作成する" class="headerlink" title="手順 4. Azure イメージ サービスを使用して VHD ファイルからマネージド イメージを作成する"></a>手順 4. Azure イメージ サービスを使用して VHD ファイルからマネージド イメージを作成する</h4><p>1 ) Azure poral の [イメージ] サービスにアクセスし、 [+作成] をクリックします。</p><p>2 ) 必要なフィールドを入力しイメージを作成します。作成されたイメージはマネージド イメージに格納されます。</p><ul><li>VMの世代は、システム要件に沿って [Gen 2] を選択します</li><li>ストレージ BLOBで、アップロードした VHD を選択します</li></ul><p><img src="/blog/windows-365/create-custom-image/2-4-1.png"></p><h4 id="手順-5-マネージド-イメージをクラウド-PC-のカスタム-イメージとして-Intune-にアップロードする"><a href="#手順-5-マネージド-イメージをクラウド-PC-のカスタム-イメージとして-Intune-にアップロードする" class="headerlink" title="手順 5. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする"></a>手順 5. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする</h4><p>手順については、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/add-device-images#add-a-custom-device-image">カスタム デバイス イメージを追加する - カスタム デバイス イメージを追加または削除する | Windows 365 Enterprise</a></p></blockquote><p>※ カスタム イメージのアップロードには、約１～2時間程かかる場合があります。<br>※ アップロードのステータスは、通知領域または [カスタム イメージ] タブ の一覧から確認することができます。</p></details><details><summary>番外編. Azure Virtual Machine (トラステッド起動) で作成</summary><h3 id="番外編-Azure-Virtual-Machine-トラステッド起動-で作成"><a href="#番外編-Azure-Virtual-Machine-トラステッド起動-で作成" class="headerlink" title="番外編. Azure Virtual Machine (トラステッド起動) で作成"></a>番外編. Azure Virtual Machine (トラステッド起動) で作成</h3><p>手順 1. TPM 起動の仮想マシンを作成しカスタマイズする<br>手順 2. VHD ファイルを Azure ストレージ アカウントに copy する<br>手順 3. Azure イメージ サービスを使用して VHD ファイルからマネージド イメージを作成する<br>手順 4. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする  </p><p>TPM 起動の Azure VM からイメージを作成する場合は、以下の理由から Standard 起動の Azure VM とは異なる手順となります。</p><p>Windows 365 のカスタム イメージはマネージド イメージである必要がありますが、現在、TPM 起動の仮想マシンがマネージド イメージをサポートしていないため、Azure VM のキャプチャでは作成したイメージをマネージド イメージに格納することができません。そのため、TPM 起動の Azure Virtual Machine でイメージを作成する場合、ディスクのイメージ化は Azure VM のキャプチャではなく、Azure イメージサービスを使用します。<br>Azure イメージ サービスでは VHD ファイルからイメージ作成が可能で、作成されたイメージはマネージド イメージに格納されます。</p><h4 id="手順-1-TPM-起動の仮想マシンを作成しカスタマイズする"><a href="#手順-1-TPM-起動の仮想マシンを作成しカスタマイズする" class="headerlink" title="手順 1. TPM 起動の仮想マシンを作成しカスタマイズする"></a>手順 1. TPM 起動の仮想マシンを作成しカスタマイズする</h4><p>1 ) Azure portal の [Virtual Machine] サービスにアクセスし、[+作成] &gt; [Azure 仮想マシン] を選択します。</p><p><img src="/blog/windows-365/create-custom-image/2-1-1.png"></p><p>2 ) 必要なフィールドを入力し、Azure 仮想マシンを作成します。</p><ul><li>セキュリティの種類は [トラステッド起動の仮想マシン] を選択します</li><li>イメージは、Windows 365 クラウド PC 用のギャラリー イメージの使用を推奨します (<a href="#1-%E7%95%99%E6%84%8F%E7%82%B9">留意点</a> をご参照ください)<br>※ 選択項目下の [すべてのイメージを表示] リンクから Windows 365 Cloud PC image template が選択できます。</li></ul><p><img src="/blog/windows-365/create-custom-image/B-1-2.png"></p><p>3 ) 仮想マシンが作成されたら、必要に応じてイメージや Teams の最適化、アプリケーションのインストール、Windows の更新プログラムの適用等を実施します。(<a href="#1-%E7%95%99%E6%84%8F%E7%82%B9">留意点</a> をご参照ください)</p><p>4 ) 一般化されたイメージを作成するために sysprep を実行し、仮想マシンをシャットダウンします。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/prepare-for-upload-vhd-image#generalize-a-vhd">VHD の一般化 - Azure にアップロードする Windows VHD または VHDX を準備する | Azure Virtual Machines</a></p></blockquote><p>5 ) 仮想マシンを停止します。</p><p><img src="/blog/windows-365/create-custom-image/2-1-3.png"></p><h4 id="手順-2-VHD-ファイルを-Azure-ストレージ-アカウントに-copy-する"><a href="#手順-2-VHD-ファイルを-Azure-ストレージ-アカウントに-copy-する" class="headerlink" title="手順 2. VHD ファイルを Azure ストレージ アカウントに copy する"></a>手順 2. VHD ファイルを Azure ストレージ アカウントに copy する</h4><p>Azure 仮想マシンの OS ディスク エクスポート URL を生成し、ストレージ アカウントに VHD ファイルを copy します。<br>ここでは、Cloud Shell を利用して azcopy コマンドを使用する例をご紹介します。</p><blockquote><p><strong>事前準備</strong> ストレージ アカウントを作成し、<a href="https://azure.microsoft.com/en-us/products/storage/storage-explorer/">Azure Storage Explorer</a> をインストールします。<br>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/storage/common/storage-account-create?tabs=azure-portal">Azure Storage アカウントを作成する | Azure ストレージ</a></p></blockquote><p>1 ) Azure portal で仮想マシンを開き、OS ディスクのダウンロード URL を生成します。ここで生成した URL は、azcopy 実行時に使用します。</p><p>手順については、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/download-vhd?tabs=azure-portal#generate-download-url">ダウンロード URL の生成 - Azure から Windows VHD をダウンロードする | Azure Virtual Machines</a></p></blockquote><p>2 ) Azure portal でストレージ アカウントを開き、左ペインの [データ ストレージ] &gt; [コンテナー] からコピー先のコンテナに移動します。</p><p>3 ) 左ペインの [共有アクセス トークン] を開き、書き込み可能なアクセス許可を設定します。<br>[SAS トークンおよび URL を生成] をクリックして、ー時的にアクセスが可能な制限付き URL を生成します。<br>ここで生成した URL は、azcopy 実行時に使用します。</p><p><img src="/blog/windows-365/create-custom-image/B-2-3.png"></p><p>4 ) Azure portal から Cloud Shell を起動します。</p><p><img src="/blog/windows-365/create-custom-image/B-2-4.png"></p><p>5 ) azcopy コマンドを利用して、VHD ファイルをストレージアカウントにコピーします。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/storage/common/storage-use-azcopy-blobs-copy">AzCopy v10 を使用して Azure ストレージ アカウント間で BLOB をコピーする | Azure storage</a></p></blockquote><p># 変数を用いたコマンド実行例  (※ [Shift] + [Insert] キー でペーストが可能です)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ export DEST_URL=&quot;&lt;コピー先のストレージアカウントの URL (コピー先)&gt;&quot;</span><br><span class="line">$ export FROM_URL=&quot;&lt;エクスポート用に生成された URL (コピー元)&gt;&quot;</span><br><span class="line">$ azcopy copy $FROM_URL $DEST_URL  --blob-type PageBlob</span><br></pre></td></tr></table></figure><p><img src="/blog/windows-365/create-custom-image/B-2-5.png"></p><h4 id="手順-3-Azure-イメージ-サービスを使用して-VHD-ファイルからマネージド-イメージを作成する"><a href="#手順-3-Azure-イメージ-サービスを使用して-VHD-ファイルからマネージド-イメージを作成する" class="headerlink" title="手順 3. Azure イメージ サービスを使用して VHD ファイルからマネージド イメージを作成する"></a>手順 3. Azure イメージ サービスを使用して VHD ファイルからマネージド イメージを作成する</h4><p>1 ) Azure poral の [イメージ] サービスにアクセスし、 [+作成] をクリックします。</p><p>2 ) 必要なフィールドを入力しイメージを作成します。作成されたイメージはマネージド イメージに格納されます。</p><ul><li>VMの世代は、システム要件に沿って [Gen 2] を選択します</li><li>ストレージ BLOBで、アップロードした VHD を選択します</li></ul><p><img src="/blog/windows-365/create-custom-image/2-4-1.png"></p><h4 id="手順-4-マネージド-イメージをクラウド-PC-のカスタム-イメージとして-Intune-にアップロードする"><a href="#手順-4-マネージド-イメージをクラウド-PC-のカスタム-イメージとして-Intune-にアップロードする" class="headerlink" title="手順 4. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする"></a>手順 4. マネージド イメージをクラウド PC のカスタム イメージとして Intune にアップロードする</h4><p>手順については、以下の公開情報をご参照ください。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/windows-365/enterprise/add-device-images#add-a-custom-device-image">カスタム デバイス イメージを追加する - カスタム デバイス イメージを追加または削除する | Windows 365 Enterprise</a></p></blockquote><p>※ カスタム イメージのアップロードには、約１～2時間程かかる場合があります。<br>※ アップロードのステータスは、通知領域または [カスタム イメージ] タブ の一覧から確認することができます。</p></details><h2 id="3-補足"><a href="#3-補足" class="headerlink" title="3. 補足"></a>3. 補足</h2><hr><p>◆ <strong>sysprep 実行時に以下のようなエラーが出た場合</strong><br>外部のサイトではございますが、弊社社員の以下のブログ記事の対処方法をご参照ください。</p><blockquote><p>参考 : <a href="https://zenn.dev/microsoft/articles/3d34892fc29272">Windows 365 : カスタム イメージを使用する vol.1 - 作成編</a></p></blockquote><p><img src="/blog/windows-365/create-custom-image/3.png"></p><p>◆ <strong>Azure VM は sysprep 実行後は起動できません</strong><br>Azure VM を別途利用したい場合は、停止した上で sysprep 実行前にスナップショットを作成、ダウンロードします。</p><blockquote><p>参考 : <a href="https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/download-vhd?tabs=azure-portal#alternative-snapshot-the-vm-disk">代替手段: VM ディスクのスナップショットを作成する - Azure から Windows VHD をダウンロードする | Azure Virtual Machines</a></p></blockquote><p>◆ <strong>azcopy を使ってローカルの VHD ファイルを Azure ストレージアカウントにコピーする方法</strong><br>Hyper-V の仮想マシンからイメージを作成する場合において、Azure ストレージ アカウントにローカルの VHD ファイルをコピーする方法として Azure Storage Explorer をご紹介しましたが、azcopy も使用できます。</p><p>例）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　azcopy copy &quot;&lt;コピー元ディレクトリ&gt;&quot; &quot;&lt;コピー先 ストレージ アカウントの SAS URL&gt;&quot; --blob-type Pageblob</span><br></pre></td></tr></table></figure><p>ストレージアカウントの SAS URL の取得方法、および azcopy の実行手順については、番外編. Azure Virtual Machine (TPM 起動) で作成 の手順 2. をご覧ください。</p><p>今回の投稿は以上です。<br>不明点などがありましたら、弊社サポートサービスまでお気軽にお問合せください。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Windows 365 の過去のサポート ブログ記事は、&lt;a href=&quot;https://jpmem.github.io/blog/tags/Windows-365/&quot;&gt;こちらから&lt;/a&gt;ご覧ください。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;本記事では、Windows 365 クラウド PC のカスタム イメージ作成方法について記載します。&lt;br&gt;Windows 365 では、イメージを作成してカスタム イメージとして Intune にアップロードし、クラウド PC のプロビジョニングに使用することが可能です。イメージ元には、Azure Virtual Machine (以下、Azure VM) または Hyper-V 上の仮想マシンを使用します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="windows 365" scheme="https://jpspsupport.github.io/blog/tags/windows-365/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline モジュールの廃止に伴う SharePoint アドインへの影響について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/impact-of-msonline-retirement/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/impact-of-msonline-retirement/</id>
    <published>2023-04-12T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.869Z</updated>
    
    <content type="html"><![CDATA[<p>この投稿では、MSOnline モジュールの廃止に伴う SharePoint アドインへの影響について記載します。<br>多くの場合は代替コマンドでご対応いただくことが出来ますが、特定の運用方法をご利用の場合（特にアプリケーション プロバイダーとして複数テナントにストアを介さずに SharePoint アドインを配布している場合）は、ご自身のアドインが影響を受けないか今一度ご確認ください。</p><p>※ 2023 年 6 月 29 日 更新<br>MS Online モジュールの非推奨の期限が 2024 年 3 月 30 日 に延期されました。詳細につきましては、Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/important-azure-ad-graph-retirement-and-powershell-module/ba-p/3848270">Important: Azure AD Graph Retirement and Powershell Module Deprecation</a> をご確認くださいますようお願いいたします。</p><h2 id="MSOnline-モジュールの廃止後の-SharePoint-アドインのクライアント-シークレットの更新方法"><a href="#MSOnline-モジュールの廃止後の-SharePoint-アドインのクライアント-シークレットの更新方法" class="headerlink" title="MSOnline モジュールの廃止後の SharePoint アドインのクライアント シークレットの更新方法"></a>MSOnline モジュールの廃止後の SharePoint アドインのクライアント シークレットの更新方法</h2><p>組織のアプリ カタログもしくは AppRegNew.aspx ページを使用して登録した SharePoint アドインのクライアント シークレットは、以下の公開情報に記載の <a href="https://learn.microsoft.com/ja-jp/powershell/module/msonline/new-msolserviceprincipalcredential?view=azureadps-1.0">New-MsolServicePrincipalCredential</a> コマンドで更新することが出来ました。</p><p>公開情報：<a href="https://learn.microsoft.com/ja-jp/sharepoint/dev/sp-add-ins/replace-an-expiring-client-secret-in-a-sharepoint-add-in#generate-a-new-secret">SharePoint アドインで期限が切れたクライアント シークレットを置換する</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-MsolServicePrincipalCredential</span> <span class="literal">-AppPrincipalId</span> <span class="variable">$clientId</span> <span class="literal">-Type</span> Password <span class="literal">-Usage</span> Verify <span class="literal">-Value</span> <span class="variable">$newClientSecret</span> <span class="literal">-StartDate</span> <span class="variable">$dtStart</span> <span class="literal">-EndDate</span> <span class="variable">$dtEnd</span></span><br></pre></td></tr></table></figure><p>しかしながら、MSOnline モジュールは 2024 年 4 月 30 日に非推奨とされ、その後、廃止される予定であり、これに伴い New-MsolServicePrincipalCredential コマンドも利用できなくなります。（MSOnline モジュールの廃止につきましては、こちらの<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/important-azure-ad-graph-retirement-and-powershell-module/ba-p/3848270">ブログ</a>をご参照ください。）</p><p>MSOnline モジュールの廃止後は、Microsoft Graph PowerShell モジュールの New-MsolServicePrincipalCredential コマンドの代替コマンドとして <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.applications/add-mgserviceprincipalpassword?view=graph-powershell-1.0">Add-MgServicePrincipalPassword</a> コマンドでクライアント シークレットを更新いただけます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> Microsoft.Graph.Applications</span><br><span class="line"><span class="variable">$params</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">PasswordCredential = <span class="selector-tag">@</span>&#123;</span><br><span class="line">DisplayName = <span class="string">&quot;Password friendly name&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Add-MgServicePrincipalPassword</span> <span class="literal">-ServicePrincipalId</span> <span class="variable">$servicePrincipalId</span> <span class="literal">-BodyParameter</span> <span class="variable">$params</span></span><br></pre></td></tr></table></figure><h2 id="どの様な影響があるか"><a href="#どの様な影響があるか" class="headerlink" title="どの様な影響があるか"></a>どの様な影響があるか</h2><p>従来の New-MsolServicePrincipalCredential コマンドではクライアント シークレットを前もって生成した後で、その値を引数として指定することが出来ました。しかし、代替の Add-MgServicePrincipalPassword コマンドでは、クライアント シークレットに Azure AD が生成したランダムな値を自動的に登録するため、管理者が前もって用意していたシークレットの値を指定することが出来ません。</p><p>残念ながら、Add-MgServicePrincipalPassword コマンドでクライアント シークレットの値を指定可能になる予定はございません。（代替方法が提供された際には、本ブログを更新いたします。）</p><p>そのため、アプリの運用の一環として特定のクライアント シークレットの値を指定する必要がある場合、運用方法の見直しをご検討いただく必要がございます。</p><p>クライアント シークレットの値を指定する必要がある運用の一例として、プロバイダー ホスト型アドインを複数テナントにストアを介さずに展開する運用方法が考えられます。<br>下図のように、プロバイダーはアプリのインストーラー等で各テナントにアドインを登録し、その時に同一のクライアント シークレットを指定して登録することで、プロバイダーは各テナントに同じシークレットを使用して接続することが可能になります。MSOnline モジュールの廃止後は、シークレットを指定して登録することが出来ないため、各テナントで登録されたシークレットがそれぞれ別のランダム値となります。その結果、同じクライアント ID とシークレットを共有する運用は不可能となり、運用方法の見直しを検討いただく必要があります。</p><p><img src="/blog/sharepoint-online/impact-of-msonline-retirement/impact-of-msonline-retirement-img1.png" alt="影響を受ける可能性のあるアドインの配布方法の説明画像"></p><h2 id="必要な対応について"><a href="#必要な対応について" class="headerlink" title="必要な対応について"></a>必要な対応について</h2><p>クライアント シークレットに特定の値を指定する必要が無い場合は、代替の <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.applications/add-mgserviceprincipalpassword?view=graph-powershell-1.0">Add-MgServicePrincipalPassword</a> コマンドを使用できますので、コマンドの切り替え以外の対応は不要です。</p><p>クライアント シークレットに特定の値を指定する必要がある場合は、シークレットを指定しない運用方法に切り替えていただく必要がございます。<br>しかしながら、短期間で運用方法を変更することは非常に困難と認識しております。<br>取り急ぎの対処として、クライアント シークレットを特定の値に指定する必要がある場合は、MSOnline モジュールが廃止される 2023 年 6 月 30 日までに、<a href="https://learn.microsoft.com/ja-jp/powershell/module/msonline/new-msolserviceprincipalcredential?view=azureadps-1.0">New-MsolServicePrincipalCredential</a> コマンドで　SharePoint アドインのクライアント シークレットを更新して有効期限を延長することをお勧めいたします。<br>その後、クライアント シークレットの有効期限までに、シークレットを指定しない運用方法への切り替えを実施くださいますようお願いいたします。</p><p>&lt;考えられる代替方法&gt;</p><ul><li>SharePoint ストアでアドインを展開し、<a href="https://learn.microsoft.com/ja-jp/partner-center/marketplace/create-or-update-client-ids-and-secrets">販売者ダッシュボードからシークレットを更新する</a></li><li>Azure AD のマルチテナント アプリを使用してアプリ専用の権限のアクセス トークンを取得する（ユーザー委任の権限は従来のシステムを使用することが可能）</li><li>SharePoint アドインを SharePoint Framework ソリューションに置き換える（アプリ全体の修正が必要）</li></ul><p>今回の投稿は以上です。<br>不明な点などがありましたら、弊社サポートサービスまでお気軽にお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;この投稿では、MSOnline モジュールの廃止に伴う SharePoint アドインへの影響について記載します。&lt;br&gt;多くの場合は代替コマンドでご対応いただくことが出来ますが、特定の運用方法をご利用の場合（特にアプリケーション プロバイダーとして複数テナントにストアを介</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>SharePoint Online 管理シェルは SharePoint Online Client Components SDK がインストールされた端末で使用できません</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/managementshell-clientcomponentsSDK/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/managementshell-clientcomponentsSDK/</id>
    <published>2021-07-12T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.873Z</updated>
    
    <content type="html"><![CDATA[<p>SharePoint Online 管理シェル (SharePoint Online Management Shell) と SharePoint Client Component SDK を同じ端末上にインストールした場合、SharePoint Online 管理シェルの起動時にモジュールの読み込みに失敗し、エラーが発生します。</p><p><img src="/blog/sharepoint-online/managementshell-clientcomponentsSDK/SPOManagementShell.png" alt="SharePoint Online 管理シェル起動時のエラー"></p><p>このエラーは、Windows PowerShell 上で “Microsoft.Online.SharePoint.PowerShell” モジュールを指定してインポートした場合にも同様に発生します。</p><p><img src="/blog/sharepoint-online/managementshell-clientcomponentsSDK/WindowsPowerShell.png" alt="Windows PowerShell のモジュール読み込み時のエラー"></p><p>&lt;エラー メッセージの抜粋&gt;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Import-Module : Could not load type &#x27;Microsoft.SharePoint.Client.Publishing.PortalLaunch.PortalLaunchRedirectionType&#x27;</span><br><span class="line">from assembly &#x27;Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral,</span><br><span class="line">PublicKeyToken=71e9bce111e9429c&#x27;.</span><br><span class="line">At line:1 char:1</span><br><span class="line">+ Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChec ...</span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : NotSpecified: (:) [Import-Module], TypeLoadException</span><br><span class="line">    + FullyQualifiedErrorId : System.TypeLoadException,Microsoft.PowerShell.Commands.ImportModuleCommand</span><br></pre></td></tr></table></figure><p>エラーを回避して SharePoint Online 管理シェルを利用するには、SharePoint Online Client Components SDK をアンインストールする必要があります。<br>本内容は、以下の公開情報にも記載されております。</p><p>タイトル : SharePoint Online 管理シェルを使用して作業を開始する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/powershell/sharepoint/sharepoint-online/connect-sharepoint-online?view=sharepoint-ps">https://docs.microsoft.com/ja-jp/powershell/sharepoint/sharepoint-online/connect-sharepoint-online?view=sharepoint-ps</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharePoint Online 管理シェル モジュールと SharePoint クライアント コンポーネント SDK の間には既知の問題があります。この SDK では、両方が同じコンピューターにインストールされている場合、モジュールの読み込みに失敗します。 この問題が発生した場合は、SharePoint クライアント コンポーネント SDK をアンインストールします。</span><br></pre></td></tr></table></figure><h2 id="SharePoint-Online-Client-Components-SDK-のアンインストール手順"><a href="#SharePoint-Online-Client-Components-SDK-のアンインストール手順" class="headerlink" title="SharePoint Online Client Components SDK のアンインストール手順"></a>SharePoint Online Client Components SDK のアンインストール手順</h2><ol><li>[コントロール パネル] で [プログラム] &gt; [プログラムのアンインストール] をクリックします。</li><li>“SharePoint Client Components” を右クリックして、[アンインストール] をクリックします。<br>※ これにより、SDK によってグローバル アセンブリ キャッシュ (GAC) に配置された CSOM アセンブリが削除されます。</li><li> SharePoint Online 管理シェルを再起動して、エラーが解消されることをご確認ください。</li></ol><p>端末上で SharePoint CSOM と SharePoint Online 管理シェルの両方を使用する必要がある場合は、SharePoint Online Client Components SDK でインストールされる CSOM パッケージを NuGet パッケージとしてウェブからダウンロードすることで、SharePoint Online 管理シェルと CSOM を同じ端末上で利用することが出来ます。</p><h2 id="CSOM-パッケージをダウンロードする"><a href="#CSOM-パッケージをダウンロードする" class="headerlink" title="CSOM パッケージをダウンロードする"></a>CSOM パッケージをダウンロードする</h2><ol><li>インターネットに接続可能な端末で、下記サイトから Microsoft.SharePointOnline.CSOM パッケージをダウンロードします。</li></ol><p>タイトル : Microsoft.SharePointOnline.CSOM<br>アドレス : <a href="https://www.nuget.org/packages/Microsoft.SharePointOnline.CSOM">https://www.nuget.org/packages/Microsoft.SharePointOnline.CSOM</a></p><ol start="2"><li>.nupkg ファイルの拡張子を .zip に変更します。</li><li>.zip ファイルを展開します。</li><li>lib\net45 フォルダー内の DLL を任意の場所にコピーします。(C:\CSOM\lib\net45\ 等)</li><li>ご利用のアプリケーションで CSOM アセンブリを読み込めることをご確認ください。<br>※パスを指定してアセンブリを読み込んでいた場合は、必要に応じてパスを変更ください。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;SharePoint Online 管理シェル (SharePoint Online Management Shell) と SharePoint Client Component SDK を同じ端末上にインストールした場合、SharePoint Online 管理シェルの</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>TLS 1.0 や 1.1 廃止による TokenHelper アプリ専用トークン取得動作への影響について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/impact-of-tokenhelper-from-disabling-tls1.0/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/impact-of-tokenhelper-from-disabling-tls1.0/</id>
    <published>2021-03-24T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.869Z</updated>
    
    <content type="html"><![CDATA[<p>Microsoft 365 においては、メッセージ センターや各公開情報に記載の通り、TLS 1.0 と 1.1 を廃止し、新しい暗号化技術を基準とすることで、お客様データのセキュリティ保護を向上する動きを拡大しております。<br>全世界のお客様を想定すると一部に限定されることを想定してはおりますが、特に旧バージョンのオペレーティング システムや .NET Framework (4.5 以下) 基盤をご利用の場合は、ご自身のシステムが影響を受けないか今一度ご確認ください。</p><p>一般的な HTTPS 通信においては、トランスポート層において TLS プロトコルはクライアントとサーバーで対応バージョン等の情報を交換し、ハンドシェイクを実施します。該当処理の確立後は、当該暗号化技術の上で上位層 (アプリケーション層を含む) の通信を開始していく流れです。<br>TLS 1.0 や 1.1 が廃止が適応されると、クライアントから TLS 1.0 を要求した際に、Microsoft 365 の各種サーバーがこれを拒否し、トランスポート層で通信が遮断される動作となります。</p><p>このような遮断を受けた時、.NET アプリケーション側で確認する典型的なエラーは以下となります。</p><h3 id="典型的な例外の例"><a href="#典型的な例外の例" class="headerlink" title="典型的な例外の例"></a>典型的な例外の例</h3><p><code>System.Net.WebException: The underlying connection was closed: An unexpected error occurred on a send. --&gt; System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. --&gt; System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host.</code></p><p>HttpWebRequest.GetResponse メソッドや、Client Side Object Model (CSOM) などでは、上記のようなエラーで、通信が遮断される動作が想定されます。<br>なお、TokenHelper などでアプリ専用トークンをご利用の場合は、少し異なったエラーが発生します。</p><h3 id="TokenHelper-アプリ専用トークン取得時の例"><a href="#TokenHelper-アプリ専用トークン取得時の例" class="headerlink" title="TokenHelper アプリ専用トークン取得時の例"></a>TokenHelper アプリ専用トークン取得時の例</h3><p><code>Microsoft.IdentityModel.SecurityTokenService.RequestFailedException: Token request failed. ---&gt; System.Net.WebException: The remote server returned an error: (401) Unauthorized.at System.Net.HttpWebRequest.GetResponse() at Microsoft.IdentityModel.S2S.Protocols.OAuth2.OAuth2WebRequest.GetResponse() at Microsoft.IdentityModel.S2S.Protocols.OAuth2.OAuth2S2SClient.Issue(String securityTokenServiceUrl OAuth2AccessTokenRequest oauth2Request) --- End of inner exception stack trace --- at Microsoft.IdentityModel.S2S.Protocols.OAuth2.OAuth2S2SClient.Issue(String securityTokenServiceUrl OAuth2AccessTokenRequest oauth2Request) at SampleNameSpace.TokenHelper.GetAppOnlyAccessToken(String targetPrincipalName String targetHost String targetRealm)</code></p><p>上記エラーが発生したとしても、対処方法としては TLS 1.2 を有効化する対応を実施ください。</p><h3 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h3><p>公開情報ご確認の上、上記のようなエラーが発生した場合は TLS 1.0 および 1.1 無効化による影響を疑い、対処を実施ください。</p><p>タイトル : TLS 1.2 を有効にする方法<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/security/enable-tls-1-2">https://docs.microsoft.com/ja-jp/mem/configmgr/core/plan-design/security/enable-tls-1-2</a></p><p>なお、Azure App Service 上のアプリで .NET Framework 4.5 以下をご使用の場合は、対象のフレームワークバージョンを 4.6 以上に上げることが推奨です。<br>ただし、参照アセンブリ等、依存関係の理由により難しい場合は、以下のコードを一行だけアプリケーションのなるべく早い段階の処理として加えることをお勧めします。<br>下記更新対象の値は static プロパティとしてアプリケーション全体をスコープとして影響し、アウトバウンドの TLS バージョンを 1.2 に指定します。 </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12;</span><br></pre></td></tr></table></figure><h3 id="詳細説明"><a href="#詳細説明" class="headerlink" title="詳細説明"></a>詳細説明</h3><p>TokenHelper では、Realm を取得し、ClientID, ClientSecret および Realm を使用して、アクセストークンを取得する流れとなります。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get the realm for the URL</span></span><br><span class="line"><span class="built_in">string</span> realm = TokenHelper.GetRealmFromTargetUrl(<span class="keyword">new</span> Uri(siteUrl));</span><br><span class="line"></span><br><span class="line"><span class="comment">//Get the access token for the URL.  </span></span><br><span class="line"><span class="built_in">string</span> accessToken = TokenHelper.GetAppOnlyAccessToken(TokenHelper.SharePointPrincipal, <span class="keyword">new</span> Uri(siteUrl).Authority, realm).AccessToken;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a client context object based on the retrieved access token</span></span><br><span class="line"><span class="keyword">using</span> (ClientContext cc = TokenHelper.GetClientContextWithAccessToken(siteUrl, accessToken))</span><br><span class="line">&#123;</span><br><span class="line">    cc.Load(cc.Web, p =&gt; p.Title);</span><br><span class="line">    cc.ExecuteQuery();</span><br><span class="line">    Console.WriteLine(cc.Web.Title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>エラーが発生する流れとして、まずは TLS によりトランスポート層で拒否されることにより、TokenHelper.GetReamFromTargetUrl メソッド内で上記典型的な例外 : WebException (内部例外は IOException と SocketException) が返されます。<br>しかし、GetRealmFromTargetUrl メソッドは WebException をメソッド外部にスローしない実装です。該当リクエストは HTTP 応答 401 が返ることを想定したコードであるため、内部で例外を補足し、HTTP 応答ヘッダー WWW-Authenticate の値から Realm の情報を読み取ろうとします。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetRealmFromTargetUrl</span>(<span class="params">Uri targetApplicationUri</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">WebRequest request = WebRequest.Create(targetApplicationUri + <span class="string">&quot;/_vti_bin/client.svc&quot;</span>);</span><br><span class="line">request.Headers.Add(<span class="string">&quot;Authorization: Bearer &quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">using</span> (request.GetResponse())</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">catch (WebException e)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (e.Response == <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> bearerResponseHeader = e.Response.Headers[<span class="string">&quot;WWW-Authenticate&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(bearerResponseHeader))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">string</span> bearer = <span class="string">&quot;Bearer realm=\&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">int</span> bearerIndex = bearerResponseHeader.IndexOf(bearer, StringComparison.Ordinal);</span><br><span class="line"><span class="keyword">if</span> (bearerIndex &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> realmIndex = bearerIndex + bearer.Length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bearerResponseHeader.Length &gt;= realmIndex + <span class="number">36</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">string</span> targetRealm = bearerResponseHeader.Substring(realmIndex, <span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">Guid realmGuid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Guid.TryParse(targetRealm, <span class="keyword">out</span> realmGuid))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> targetRealm;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>しかし、トランスポート層で通信が拒否されます。アプリケーション層での通信は実行されないため、SharePoint Online サーバーから HTTP 応答ヘッダー WWW-Authenticate などの値は返されません。このことにより例外オブジェクトの HTTP ヘッダーから Realm が取得できず、Realm が null として返されます。</p><p>その結果、次の GetAppOnlyAccessToken メソッドに targetRealm が null が渡されます。<br>ACS に渡されるクライアント ID は、ClientID@Realm の形式で渡されます。この値が不正な形式 (ClientID@) となるため、HTTP 応答コード 401 と共に RequestFailedException が返されます。</p><p>もちろん、RequestFailedException 単体を見た場合、アプリケーションへの変更により、Client ID が使用できなくなった場合や、Client Secret の有効期限が切れた等の別事象も切り分ける必要はあります。<br>その際には、最新の Windows 端末等より、Connect-PnPOnline コマンドを実行して、アプリ定義自体に問題がないことを切り分けるのも有効な手段です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Connect-PnPOnline</span> https://&#123;tenant&#125;.sharepoint.com <span class="literal">-ClientId</span> &lt;クライアント ID&gt; <span class="literal">-ClientSecret</span> &lt;クライアント シークレット&gt;</span><br></pre></td></tr></table></figure><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>タイトル : Microsoft 365 の TLS 1.0 と 1.1 を無効にする<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/compliance/tls-1.0-and-1.1-deprecation-for-office-365?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/compliance/tls-1.0-and-1.1-deprecation-for-office-365?view=o365-worldwide</a></p><p>タイトル : Office 365 および Office 365 GCC での TLS 1.2 の準備<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/microsoft-365/compliance/prepare-tls-1.2-in-office-365?view=o365-worldwide">https://docs.microsoft.com/ja-jp/microsoft-365/compliance/prepare-tls-1.2-in-office-365?view=o365-worldwide</a></p><p>今回の投稿は以上です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Microsoft 365 においては、メッセージ センターや各公開情報に記載の通り、TLS 1.0 と 1.1 を廃止し、新しい暗号化技術を基準とすることで、お客様データのセキュリティ保護を向上する動きを拡大しております。&lt;br&gt;全世界のお客様を想定すると一部に限定される</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>Power Automate で SharePoint リスト アイテムに対して個別のアクセス権を付与する方法</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/power-automate-assign-permission/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/power-automate-assign-permission/</id>
    <published>2020-07-13T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.876Z</updated>
    
    <content type="html"><![CDATA[<p>今回の投稿では、SharePoint Online における <a href="https://support.microsoft.com/ja-jp/office/1ca3fff8-9985-410a-85aa-8120f626965f?ui=ja-jp&rs=ja-jp&ad=jp">SharePoint 2010 形式ワークフローの廃止</a> (MC217999) に際して、移行先となる Power Automate を簡単に紹介します。</p><p>移行プロジェクトにおいて、最も技術的な懸案事項に指定されているものに、個別アクセス権の付与が数多く上げられております。アイテムごとにアクセス権を付与する運用は、パフォーマンスを考慮した場合は得策ではありません。しかしながら、多くのユーザーが SharePoint 2010 形式ワークフローを利用する一つの根強い理由として挙げられているため、ここに Power Automate による回避策を記載します。</p><p>なお、前提として <a href="https://docs.microsoft.com/ja-jp/office365/servicedescriptions/sharepoint-online-service-description/sharepoint-online-limits">SharePoint の制限</a> には、リストまたはライブラリ内のアイテムに対する固有の権限は 5,000 までと指定されております。そのため、固有のアクセス権を割り当てる運用を実施する場合、リストまたはライブラリ内のアイテムが 5,000 を超えないようキャパシティ プランをお願いします。</p><h2 id="公開情報より"><a href="#公開情報より" class="headerlink" title="公開情報より"></a>公開情報より</h2><p>公開情報には、アイテムまたはフォルダーへのアクセスを許可する、中止するといったアクションに対して、条件付きで可能との記載があります。</p><p>タイトル : ガイダンス: SharePoint で従来のワークフローから Power Automate フローに移行する<br>アドレス : <a href="https://learn.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/migrate-from-classic-workflows-to-power-automate-flows">https://learn.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/migrate-from-classic-workflows-to-power-automate-flows</a></p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM00.png" alt="PublicArticle"></p><p>モダン UI のアクセス許可もクラシックのアクセス許可に影響するので、特に大きな問題はありません。以下のように落ち着いてソリューションを実施しましょう。</p><h2 id="ウォークスルー"><a href="#ウォークスルー" class="headerlink" title="ウォークスルー"></a>ウォークスルー</h2><h3 id="1-まずは、モダン-UI-のリストやライブラリから、-自動化-–-Power-Automate-–-フローの作成-よりフローを作成していきます。"><a href="#1-まずは、モダン-UI-のリストやライブラリから、-自動化-–-Power-Automate-–-フローの作成-よりフローを作成していきます。" class="headerlink" title="1. まずは、モダン UI のリストやライブラリから、[自動化] – [Power Automate] – [フローの作成] よりフローを作成していきます。"></a>1. まずは、モダン UI のリストやライブラリから、[自動化] – [Power Automate] – [フローの作成] よりフローを作成していきます。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM01.png" alt="HowToStartPA"></p><h3 id="2-フローの作成ペインにて、-詳細の表示-–-既存の-SharePoint-リスト項目が修正されたときに、カスタム-アクションを完了する-をクリックします。"><a href="#2-フローの作成ペインにて、-詳細の表示-–-既存の-SharePoint-リスト項目が修正されたときに、カスタム-アクションを完了する-をクリックします。" class="headerlink" title="2. フローの作成ペインにて、[詳細の表示] – [既存の SharePoint リスト項目が修正されたときに、カスタム アクションを完了する] をクリックします。"></a>2. フローの作成ペインにて、[詳細の表示] – [既存の SharePoint リスト項目が修正されたときに、カスタム アクションを完了する] をクリックします。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM02.png" alt="HowToStartPA2"></p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM03.png" alt="HowToStartPA2"></p><h3 id="3-続行-をクリックします。"><a href="#3-続行-をクリックします。" class="headerlink" title="3. [続行] をクリックします。"></a>3. [続行] をクリックします。</h3><p>画像ではマスクしていますが、ここに表示されるユーザーの権限で処理が実行されます。<br>サイト コレクションの管理者権限等、十分なアクセス権をフローの作成者に与えてください。</p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM04.png" alt="HowToStartPA3"></p><h3 id="4-フローの編集画面に遷移しました。-新しいステップ-をクリックして後続の処理を追加していきます。"><a href="#4-フローの編集画面に遷移しました。-新しいステップ-をクリックして後続の処理を追加していきます。" class="headerlink" title="4. フローの編集画面に遷移しました。[+ 新しいステップ] をクリックして後続の処理を追加していきます。"></a>4. フローの編集画面に遷移しました。[+ 新しいステップ] をクリックして後続の処理を追加していきます。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM05.png" alt="HowToStartPA4"></p><h3 id="5-親のアクセス権を継承しない場合は、-アイテムまたはファイルの共有を停止します-を選択します。"><a href="#5-親のアクセス権を継承しない場合は、-アイテムまたはファイルの共有を停止します-を選択します。" class="headerlink" title="5. 親のアクセス権を継承しない場合は、[アイテムまたはファイルの共有を停止します] を選択します。"></a>5. 親のアクセス権を継承しない場合は、[アイテムまたはファイルの共有を停止します] を選択します。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM06.png" alt="BreakRoleInheritance1"></p><h3 id="6-“リストまたはライブラリ”-と-“ID”-に動的なコンテンツ-値-を設定します。"><a href="#6-“リストまたはライブラリ”-と-“ID”-に動的なコンテンツ-値-を設定します。" class="headerlink" title="6. “リストまたはライブラリ” と “ID” に動的なコンテンツ (値) を設定します。"></a>6. “リストまたはライブラリ” と “ID” に動的なコンテンツ (値) を設定します。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM07.png" alt="BreakRoleInheritance2"></p><h3 id="7-実際にアクセス権を適用していきます。アクション選択画面で-アイテムまたはフォルダーへのアクセス権の付与-をクリックします。"><a href="#7-実際にアクセス権を適用していきます。アクション選択画面で-アイテムまたはフォルダーへのアクセス権の付与-をクリックします。" class="headerlink" title="7. 実際にアクセス権を適用していきます。アクション選択画面で [アイテムまたはフォルダーへのアクセス権の付与] をクリックします。"></a>7. 実際にアクセス権を適用していきます。アクション選択画面で [アイテムまたはフォルダーへのアクセス権の付与] をクリックします。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM08.png" alt="RoleAssignmentsAdd1"></p><h3 id="8-受信者にはアクセス権を与えるユーザーを指定し、ロールには権限レベルを指定します。"><a href="#8-受信者にはアクセス権を与えるユーザーを指定し、ロールには権限レベルを指定します。" class="headerlink" title="8. 受信者にはアクセス権を与えるユーザーを指定し、ロールには権限レベルを指定します。"></a>8. 受信者にはアクセス権を与えるユーザーを指定し、ロールには権限レベルを指定します。</h3><p>この例では、リストに追加されたユーザー列である、”共同編集者” を動的なコンテンツ (値) から指定しています。<br>ロールとしては、Can edit と Can view のいずれかをプルダウンから選択します。</p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM09.png" alt="RoleAssignmentsAdd2"></p><p>これで、最低限アクセス許可を与えるフローの作成は完成です。</p><h2 id="編集や閲覧以外のアクセス許可を付与する方法"><a href="#編集や閲覧以外のアクセス許可を付与する方法" class="headerlink" title="編集や閲覧以外のアクセス許可を付与する方法"></a>編集や閲覧以外のアクセス許可を付与する方法</h2><p>アクション側の入力項目において、ロールには Can edit と Can View が 2 択で表示されますが、[カスタム値の入力] をクリックして、他のアクセス権 (ロール) を付与することは可能であることを確認しています。</p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM10.png" alt="OtherRoleDefs1"></p><p>この部分のみ、少し複雑な手順となりますが、併せて以下に記載します。</p><h3 id="1-必要とするロール定義の-ID-を取得します。"><a href="#1-必要とするロール定義の-ID-を取得します。" class="headerlink" title="1. 必要とするロール定義の ID を取得します。"></a>1. 必要とするロール定義の ID を取得します。</h3><p>以下の a か b のいずれかの方法をご利用ください。</p><h4 id="a-PowerShell-を使用する場合"><a href="#a-PowerShell-を使用する場合" class="headerlink" title="a. PowerShell を使用する場合"></a>a. PowerShell を使用する場合</h4><p>a-1. PnP PowerShell をお持ちでない場合は<a href="https://docs.microsoft.com/ja-jp/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets?view=sharepoint-ps">入手</a>します。<br>a-2. Connect-PnPOnline &lt;サイト URL&gt; を実行します。<br>a-3. Get-PnPRoleDefinition を実行して、サイトに存在するロールの定義を一覧表示します。<br>a-4. Get-PnPRoleDefinition -Identity &lt;ロール名&gt; | select Id を実行して Id を抜き出します。</p><p>以下の例では、フルコントロールの Id として 1073741829 を取得します。</p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM11.png" alt="OtherRoleDefs2"></p><h4 id="b-REST-を使用する場合"><a href="#b-REST-を使用する場合" class="headerlink" title="b. REST を使用する場合"></a>b. REST を使用する場合</h4><p>b-1. ブラウザーで SharePoint のページを表示します。<br>b-2. サイト URL 配下を以下のように変更します。<br><a href="https://tenant.sharepoint.com/sites/site/_api/web/roledefinitions">https://tenant.sharepoint.com/sites/site/_api/web/roledefinitions</a><br>b-3. XML でロール名が表示されるので、ロール名に対応する Id を取得します。</p><p>以下の例では “フル コントロール” の ID として 1073741829 を取得します。</p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM12.png" alt="OtherRoleDefs3"></p><p>IE などのブラウザーでは、フィード画面が表示される場合があります。その場合、[Alt] キーを押し、[ファイル] - [名前を付けて保存] をクリックして結果をローカル ファイルに保存すると、ブラウザー側に返されている XML のデータが保存されます。</p><h3 id="2-“アイテムまたはフォルダーへのアクセス権の付与”-のアクションにて、role-ID-値-を文字列で指定します。"><a href="#2-“アイテムまたはフォルダーへのアクセス権の付与”-のアクションにて、role-ID-値-を文字列で指定します。" class="headerlink" title="2. “アイテムまたはフォルダーへのアクセス権の付与” のアクションにて、role:ID 値 を文字列で指定します。"></a>2. “アイテムまたはフォルダーへのアクセス権の付与” のアクションにて、role:ID 値 を文字列で指定します。</h3><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM13.png" alt="OtherRoleDefs4"></p><h2 id="実行結果"><a href="#実行結果" class="headerlink" title="実行結果"></a>実行結果</h2><p>リストにアイテムを投稿すると、共同編集者列のユーザーにアクセス許可が付与される動作を確認できます。</p><p><img src="/blog/sharepoint-online/power-automate-assign-permission/PAPERM14.png" alt="TETSUOCANEDITNOW"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今回の投稿では、SharePoint Online における &lt;a href=&quot;https://support.microsoft.com/ja-jp/office/1ca3fff8-9985-410a-85aa-8120f626965f?ui=ja-jp&amp;rs=ja-jp</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>Power Automate で簡単な承認フローを作成する</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/introduction-to-power-automate/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/introduction-to-power-automate/</id>
    <published>2020-07-09T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.869Z</updated>
    
    <content type="html"><![CDATA[<p>今回の投稿では、SharePoint Online における <a href="https://support.microsoft.com/ja-jp/office/1ca3fff8-9985-410a-85aa-8120f626965f?ui=ja-jp&rs=ja-jp&ad=jp">SharePoint 2010 形式ワークフローの廃止</a> (MC217999) に際して、移行先となる Power Automate を簡単に紹介します。</p><p>これまで移行先の Power Automate の採用を決定できない一つの要因に、Power Automate に慣れていないことが挙げられていることがあると思います。<br>Power Automate の承認ワークフローを作成する方法は、様々な方々がすでに画面付きで手順を公開しておりますので、新たに作成する方法はないかと当初は考えました。しかしながら、初学の場合においては資料との相性等もあるかと思いますので、少しでも参考資料の選択肢が多い方がいいと思います。</p><p>そこで、本投稿でも手順を紹介します。現行バージョンの Power Automate でのご説明になりますが高度なものは作成せず、シンプルな処理で構成し、細かな操作を説明し、スピーディにキャッチアップできる形を目指します。</p><h2 id="移行シナリオの参考情報"><a href="#移行シナリオの参考情報" class="headerlink" title="移行シナリオの参考情報"></a>移行シナリオの参考情報</h2><p>SharePoint 2010 形式ワークフローからの移行を検討している方には、マイクロソフトからの公開情報としては以下のサイトをご確認いただくことをお勧めします。</p><p>タイトル : Power Automate の Microsoft SharePoint コネクタ<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/sharepoint-connector-actions-triggers">https://docs.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/sharepoint-connector-actions-triggers</a></p><p>タイトル : Power Automate を使用して SharePoint でドキュメントの承認を要求する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/require-doc-approval">https://docs.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/require-doc-approval</a></p><p>下記サイトには、SharePoint ワークフローと Power Automate の機能の対比表が含まれています。</p><p>タイトル : ガイダンス: SharePoint で従来のワークフローから Power Automate フローに移行する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/migrate-from-classic-workflows-to-power-automate-flows">https://docs.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/migrate-from-classic-workflows-to-power-automate-flows</a></p><h2 id="ウォークスルー"><a href="#ウォークスルー" class="headerlink" title="ウォークスルー"></a>ウォークスルー</h2><p>それでは、実際に Power Automate で処理を作成していき、操作に慣れることを目指しましょう。</p><h3 id="1-コマンド-バーより-自動化-–-Power-Automate-–-フローの作成-をクリックします。"><a href="#1-コマンド-バーより-自動化-–-Power-Automate-–-フローの作成-をクリックします。" class="headerlink" title="1. コマンド バーより [自動化] – [Power Automate] – [フローの作成] をクリックします。"></a>1. コマンド バーより [自動化] – [Power Automate] – [フローの作成] をクリックします。</h3><p>モダン UI で、リストやライブラリを表示すると、コマンドバーに [自動化] というメニューがあります。SharePoint は、ここからフローの作成を開始できます。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA01.png" alt="PowerAutomate01"></p><h3 id="2-画面右に現れるフローの作成ペインにて-詳細の表示-を展開し、-新しいファイルが-SharePoint-に追加されたときに、カスタムアクションを完了する-をクリックしてフローの作成を開始します。"><a href="#2-画面右に現れるフローの作成ペインにて-詳細の表示-を展開し、-新しいファイルが-SharePoint-に追加されたときに、カスタムアクションを完了する-をクリックしてフローの作成を開始します。" class="headerlink" title="2. 画面右に現れるフローの作成ペインにて [詳細の表示] を展開し、[新しいファイルが SharePoint に追加されたときに、カスタムアクションを完了する] をクリックしてフローの作成を開始します。"></a>2. 画面右に現れるフローの作成ペインにて [詳細の表示] を展開し、[新しいファイルが SharePoint に追加されたときに、カスタムアクションを完了する] をクリックしてフローの作成を開始します。</h3><p>Power Automate では、シナリオに合わせてテンプレートを選択して、フローの作成を行うことができます。<br>そのため、SharePoint へのコネクターや、必要最小限の処理が含まれた状態で、フローを作成できるため生産的です。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA02.png" alt="PowerAutomate02"><br><img src="/blog/sharepoint-online/introduction-to-power-automate/PA03.png" alt="PowerAutomate03"></p><h3 id="3-続行-をクリックします。"><a href="#3-続行-をクリックします。" class="headerlink" title="3. [続行] をクリックします。"></a>3. [続行] をクリックします。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA04.png" alt="PowerAutomate04"></p><h3 id="4-フローの編集画面に遷移しました。-新しいステップ-をクリックして後続の処理を追加していきます。"><a href="#4-フローの編集画面に遷移しました。-新しいステップ-をクリックして後続の処理を追加していきます。" class="headerlink" title="4. フローの編集画面に遷移しました。[+ 新しいステップ] をクリックして後続の処理を追加していきます。"></a>4. フローの編集画面に遷移しました。[+ 新しいステップ] をクリックして後続の処理を追加していきます。</h3><p>ライブラリにファイルがアップロードされて処理が開始するという部分ができあがった状態でスタートします。当初の設定値などは、色々と観察してみてください。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA05.png" alt="PowerAutomate05"></p><h4 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h4><p>処理の最後ではなく、途中にアクションを差し込む場合は、アクション間にある線をポイントすると (+) マークが表れます。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA06.png" alt="PowerAutomate06"></p><p>さらに [アクションの追加] を押すと、アクションが挿入できます。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA07.png" alt="PowerAutomate07"></p><h3 id="5-アクション選択画面で-“承認”-を検索し、-開始して承認を待機-を選択します。"><a href="#5-アクション選択画面で-“承認”-を検索し、-開始して承認を待機-を選択します。" class="headerlink" title="5. アクション選択画面で “承認” を検索し、[開始して承認を待機] を選択します。"></a>5. アクション選択画面で “承認” を検索し、[開始して承認を待機] を選択します。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA08.png" alt="PowerAutomate08"></p><p>アクションについては、画面上側にサービス、下側にトリガーとアクションが表示されます。<br>検索機能はそれぞれに適用されます。ここでは “承認” を検索していますが、”承認” サービスだけではなく、承認というキーワードに該当するアクションを持つ各種サービスと、そのトリガーやアクションがすべて表示されています。<br>どのようなサービス、そしてそのトリガーやアクションが使用できるかは、公開情報を調べても結構ですし、ご自身で色々と検索しながら確認することもできます。</p><h3 id="6-“承認の種類”-にて、”カスタム応答-–-1-つの応答を待機”-をクリックします。"><a href="#6-“承認の種類”-にて、”カスタム応答-–-1-つの応答を待機”-をクリックします。" class="headerlink" title="6. “承認の種類” にて、”カスタム応答 – 1 つの応答を待機” をクリックします。"></a>6. “承認の種類” にて、”カスタム応答 – 1 つの応答を待機” をクリックします。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA09.png" alt="PowerAutomate09"></p><h3 id="7-“開始して承認を待機”-アクションの詳細を指定していきます。"><a href="#7-“開始して承認を待機”-アクションの詳細を指定していきます。" class="headerlink" title="7. “開始して承認を待機” アクションの詳細を指定していきます。"></a>7. “開始して承認を待機” アクションの詳細を指定していきます。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA10.png" alt="PowerAutomate10"></p><p>応答オプションには、承認者が選択する応答の選択肢 (例 承認、却下) を定義します。</p><p>各種エディターについてですが、アクションの各プロパティに直接文字入力をすると文字列の固定値が指定されます。<br>動的なコンテンツ (値) を扱いたい場合は、入力項目にフォーカスを当て、画面右下の吹き出しコンテンツから値を選択して使います。</p><h3 id="8-同じ要領で-新しいステップ-をクリックして-“条件”-アクションを追加します。"><a href="#8-同じ要領で-新しいステップ-をクリックして-“条件”-アクションを追加します。" class="headerlink" title="8. 同じ要領で [+ 新しいステップ] をクリックして “条件” アクションを追加します。"></a>8. 同じ要領で [+ 新しいステップ] をクリックして “条件” アクションを追加します。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA11.png" alt="PowerAutomate11"></p><h3 id="9-条件の左辺より順に、動的な値から-“応答”-“次の値に等しい”-文字列直接入力にて-“承認”-などと指定します。"><a href="#9-条件の左辺より順に、動的な値から-“応答”-“次の値に等しい”-文字列直接入力にて-“承認”-などと指定します。" class="headerlink" title="9. 条件の左辺より順に、動的な値から “応答”, “次の値に等しい”, 文字列直接入力にて “承認” などと指定します。"></a>9. 条件の左辺より順に、動的な値から “応答”, “次の値に等しい”, 文字列直接入力にて “承認” などと指定します。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA12.png" alt="PowerAutomate12"></p><p>1 つの応答を待機するモデルであれば、”結果” という値に、承認者が選択した値が入ってきます。<br>この値が “承認” ならば “はい” の方へ、そうでなければ “いいえ” の方に流すようにします。</p><h3 id="10-はい、いいえのそれぞれのブロックにて、-アクションの追加-をクリックし、”項目の更新”-アクションを挿入します。"><a href="#10-はい、いいえのそれぞれのブロックにて、-アクションの追加-をクリックし、”項目の更新”-アクションを挿入します。" class="headerlink" title="10. はい、いいえのそれぞれのブロックにて、[アクションの追加] をクリックし、”項目の更新” アクションを挿入します。"></a>10. はい、いいえのそれぞれのブロックにて、[アクションの追加] をクリックし、”項目の更新” アクションを挿入します。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA13.png" alt="PowerAutomate13"></p><h3 id="11-それぞれ、承認済みか却下という値を列に書き込むに今回のサンプルはとどめます。"><a href="#11-それぞれ、承認済みか却下という値を列に書き込むに今回のサンプルはとどめます。" class="headerlink" title="11. それぞれ、承認済みか却下という値を列に書き込むに今回のサンプルはとどめます。"></a>11. それぞれ、承認済みか却下という値を列に書き込むに今回のサンプルはとどめます。</h3><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA14.png" alt="PowerAutomate14"></p><h2 id="実行確認"><a href="#実行確認" class="headerlink" title="実行確認"></a>実行確認</h2><p>ユーザー エクスペリエンスを確認してみましょう。</p><p>ファイルをアップロードしてみてください。<br>しばらくすると承認者宛に以下のようなメールが届きます。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA15.png" alt="PowerAutomate15"></p><p>そこで [承認] を選択して、[送信] をクリックすると、承認処理が完了です。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA16.png" alt="PowerAutomate16"></p><p>Result 列に承認済みが記録されました。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA17.png" alt="PowerAutomate17"></p><h2 id="その他、トラブルシューティング等"><a href="#その他、トラブルシューティング等" class="headerlink" title="その他、トラブルシューティング等"></a>その他、トラブルシューティング等</h2><p>エラーがある場合は、フローの編集画面から [左矢印] をクリックして、概要ページ内にある実行履歴をクリックします。<br>この画面内に失敗のエントリーがあれば、それをクリックしてトラブルシューティングすることができます。</p><p><img src="/blog/sharepoint-online/introduction-to-power-automate/PA18.png" alt="PowerAutomate18"></p><p>初めてのテクノロジーにおいても、スモール スタートで利用開始し、そこから少しずつテストしながら追加していくことで、ソリューションを作成できるものと考えております。<br>是非移行作業を進める上で、上記資料を準備にお役立てください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今回の投稿では、SharePoint Online における &lt;a href=&quot;https://support.microsoft.com/ja-jp/office/1ca3fff8-9985-410a-85aa-8120f626965f?ui=ja-jp&amp;rs=ja-jp</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>SharePoint Modernization Scanner を使用して、移行対象のワークフローを抽出する</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/use-sp-modernization-scanner/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/use-sp-modernization-scanner/</id>
    <published>2020-07-08T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.878Z</updated>
    
    <content type="html"><![CDATA[<p>今回の投稿では、SharePoint Online における <a href="https://support.microsoft.com/ja-jp/office/1ca3fff8-9985-410a-85aa-8120f626965f?ui=ja-jp&rs=ja-jp&ad=jp">SharePoint 2010 形式ワークフローの廃止</a> (MC217999) に際しての計画段階において、移行対象のワークフローを抽出する方法を詳細に記載します。</p><p>そのためのツールとして、SharePoint Modernization Scanner (SharePoint モダン化スキャナー) が公開されています。</p><p>最初に、移行する SharePoint 2010 形式ワークフローの全体像をつかむことは必須の作業となります。これをもとに、技術的な課題項目を整理したり、工数を見積もるという作業が派生してくると思います。<br>本投稿では、できる限りスムーズに移行検討作業に移れるよう、現バージョンの SharePoint モダン化スキャナーによる操作イメージを画面付きで紹介します。</p><h2 id="1-最初に下記サイトからツールをダウンロードします。"><a href="#1-最初に下記サイトからツールをダウンロードします。" class="headerlink" title="1. 最初に下記サイトからツールをダウンロードします。"></a>1. 最初に下記サイトからツールをダウンロードします。</h2><p>タイトル : SharePoint モダン化スキャナーを使い始める<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/transform/modernize-scanner">https://docs.microsoft.com/ja-jp/sharepoint/dev/transform/modernize-scanner</a></p><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS01.png" alt="DownloadSMS"></p><h2 id="2-ダウンロードしたツールを実行します。"><a href="#2-ダウンロードしたツールを実行します。" class="headerlink" title="2. ダウンロードしたツールを実行します。"></a>2. ダウンロードしたツールを実行します。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS02.png" alt="RunSMS"></p><h3 id="2-1-クライアント-ID-とクライアント-シークレットを用意します。"><a href="#2-1-クライアント-ID-とクライアント-シークレットを用意します。" class="headerlink" title="2-1. クライアント ID とクライアント シークレットを用意します。"></a>2-1. クライアント ID とクライアント シークレットを用意します。</h3><p>Selected Authentication Option ですが、テナント全体に対して実行する場合は、あらかじめテナント内の全サイト コレクションにアクセス可能なユーザーが用意できない場合は、アプリ専用トークンを利用することが現実的です。<br>アプリ専用トークンの種類は 2 種類あります。一般的にはライフサイクルを考慮した場合、継続的なアプリケーションの開発や利用を想定した場合は Azure AD App Only が推奨されますが、どちらでも現時点での機能面に変わりはないため、今回の一時的な利用においては操作が簡単な Azure ACS App Only のシナリオを進めていただくことで問題はありません。</p><p>別途以下のサイトなどの手順で Azure ACS クライアント ID と クライアント シークレットを入手します。</p><p>タイトル : PnP PowerShell でテナントのフルコントロール権限を使用して接続する方法について<br>アドレス : <a href="https://jpspsupport.github.io/blog/sharepoint-online/pnp-powershell-with-app-only-token/">https://jpspsupport.github.io/blog/sharepoint-online/pnp-powershell-with-app-only-token/</a></p><p>なお、上記サイトはテナントに対してフルコントロール権限でアプリを払い出しておりますので、適宜権限要求 XML を変更してサイトに対するフルコントロール等に変更していただいてもかまいません。</p><h3 id="2-2-クライアント-ID-とクライアント-シークレットを入力して-Next-をクリックします"><a href="#2-2-クライアント-ID-とクライアント-シークレットを入力して-Next-をクリックします" class="headerlink" title="2-2. クライアント ID とクライアント シークレットを入力して [Next] をクリックします"></a>2-2. クライアント ID とクライアント シークレットを入力して [Next] をクリックします</h3><h3 id="2-3-対象を指定して-Next-をクリックします。"><a href="#2-3-対象を指定して-Next-をクリックします。" class="headerlink" title="2-3. 対象を指定して [Next] をクリックします。"></a>2-3. 対象を指定して [Next] をクリックします。</h3><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS03.png" alt="RunSMS2"></p><h2 id="3-Scan-mode-には-Classic-workflow-usage-を指定ください。"><a href="#3-Scan-mode-には-Classic-workflow-usage-を指定ください。" class="headerlink" title="3. Scan mode には Classic workflow usage を指定ください。"></a>3. Scan mode には Classic workflow usage を指定ください。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS04.png" alt="RunSMS3"></p><h2 id="4-最後に細かな設定が可能ですが、-Start-Scan-を押すと開始します。"><a href="#4-最後に細かな設定が可能ですが、-Start-Scan-を押すと開始します。" class="headerlink" title="4.    最後に細かな設定が可能ですが、[Start Scan] を押すと開始します。"></a>4.    最後に細かな設定が可能ですが、[Start Scan] を押すと開始します。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS04-2.png" alt="RunSMS3"></p><h2 id="5-実行時にはコマンド-プロンプトに進捗が書かれます。"><a href="#5-実行時にはコマンド-プロンプトに進捗が書かれます。" class="headerlink" title="5. 実行時にはコマンド プロンプトに進捗が書かれます。"></a>5. 実行時にはコマンド プロンプトに進捗が書かれます。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS05.png" alt="RunSMS4"></p><h2 id="6-コマンド実行が完了すると、フォルダーが実行プログラム-EXE-と同一階層に現れます。"><a href="#6-コマンド実行が完了すると、フォルダーが実行プログラム-EXE-と同一階層に現れます。" class="headerlink" title="6. コマンド実行が完了すると、フォルダーが実行プログラム (*.EXE) と同一階層に現れます。"></a>6. コマンド実行が完了すると、フォルダーが実行プログラム (*.EXE) と同一階層に現れます。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS06.png" alt="FILES"></p><h2 id="7-フォルダー内には以下のようなファイルが入っています。"><a href="#7-フォルダー内には以下のようなファイルが入っています。" class="headerlink" title="7. フォルダー内には以下のようなファイルが入っています。"></a>7. フォルダー内には以下のようなファイルが入っています。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS07.png" alt="FILES1"></p><h2 id="8-ModernizationWorkflowScanResults-csv-を開きます。"><a href="#8-ModernizationWorkflowScanResults-csv-を開きます。" class="headerlink" title="8. ModernizationWorkflowScanResults.csv を開きます。"></a>8. ModernizationWorkflowScanResults.csv を開きます。</h2><p>日本語が含まれる場合は、一度ファイルをメモ帳で開いて、名前を付けて保存し、UTF8 BOM 付きで保存しなおし、その後 Excel で開きます。</p><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS08-1.png" alt="FILES2"></p><p>Windows 10 以前の OS をご利用の場合は UTF-8 (BOM 付き) の文字コードが指定できない場合があります。この場合は、UTF-8 として上書き保存すれば明示的に BOM が指定されます。<br>手順 9 で Excel データが文字化けしている場合は、この手順がスキップされていることに起因します。</p><h2 id="9-シート上のセルをテーブルに変換し、フィルターを使用して、置き換え対象のワークフローを絞り込んでいきます。"><a href="#9-シート上のセルをテーブルに変換し、フィルターを使用して、置き換え対象のワークフローを絞り込んでいきます。" class="headerlink" title="9. シート上のセルをテーブルに変換し、フィルターを使用して、置き換え対象のワークフローを絞り込んでいきます。"></a>9. シート上のセルをテーブルに変換し、フィルターを使用して、置き換え対象のワークフローを絞り込んでいきます。</h2><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS09.png" alt="EXCEL1"></p><p>例</p><ul><li>SharePoint 2010 形式ワークフロー (Version = 2010)</li><li>リストで新規インスタンスを許可されている (Enabled = True) </li></ul><p><img src="/blog/sharepoint-online/use-sp-modernization-scanner/SMS10.png" alt="EXCEL2"></p><p>この時点で、使用中のワークフロー一覧については抽出完了です。<br>サイト コレクション管理者にコンテンツを委任している場合は、各サイト コレクション管理者に MC217999 の内容や告示内容、各サイト コレクションごとの抽出データとあわせ、Admins 列に格納されたユーザーに共有して連携してください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今回の投稿では、SharePoint Online における &lt;a href=&quot;https://support.microsoft.com/ja-jp/office/1ca3fff8-9985-410a-85aa-8120f626965f?ui=ja-jp&amp;rs=ja-jp</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>HTTP 調整のリトライロジックのテスト方法</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/Testing-backoff-logic/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/Testing-backoff-logic/</id>
    <published>2020-06-07T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.865Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>HTTP 調整リトライ ロジックを実装した際に、特に弊社公開記事に記載されたカスタムコードを変更している場合は、論理テストを実施していただく必要があります。</p><p>残念ながら、SharePoint Online に対して明示的に調整を発生させることはできないため、現実的なシナリオに即したテストなどを実施することはできません。<br>テストのためにクラウド側に不要な負荷をかけることも適切ではない行動となります。<br>そのため、基本的には論理テストを実施し、様々な想定シナリオに対するロジック テストをパスした後で、テスト済みのコードをマスターに組み込むという方法が現実的です。</p><p>今回の記事では、その疑似的な論理テストを実施する方法の 1 つをご紹介します。</p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>Fiddler の AutoResponder を使用して、CSOM などの通信に対して、任意の HTTP 応答を返して動作検証する方法があります。</p><p>まず、Fiddler を起動し、トレースを取得しておきます。</p><p><img src="/blog/sharepoint-online/Testing-backoff-logic/Fiddler1.png" alt="Fiddler1"></p><ol><li>応答を書き換えたい通信を、画面左ペインから選択します。</li><li>[AutoResponder] タブをクリックします。</li><li>Enable Rules と Unmatched requests passthrough がチェックされていることを確認します。</li><li>[Add Rule] をクリックします。</li></ol><p>次に緑の欄の設定に移ります。</p><p><img src="/blog/sharepoint-online/Testing-backoff-logic/Fiddler2.png" alt="Fiddler2"></p><ol start="5"><li>Rule Editor の下のセレクトボックスで [Create New Response…] をプルダウンから選択します。</li><li>[Save] をクリックすると、ダイアログがポップアップされます。</li></ol><p><img src="/blog/sharepoint-online/Testing-backoff-logic/Fiddler3-1.png" alt="Fiddler3-1"></p><ol start="7"><li><p>[Raw] タブをクリックします。</p></li><li><p>HTTP 応答のステータス コードに 429 TOO MANY REQUESTS を指定します。</p></li><li><p>HTTP 応答ヘッダーに Retry-After を指定して、任意の数値を指定します。<br>テスト用ですので、短い値でも問題ありません。</p></li><li><p>[Save] をクリックします。</p></li><li><p>ダイアログを [x] を押して閉じます。</p></li></ol><p>この後、Fiddler を起動してロジックをテストしてください。指定された間隔でリトライが実行されることが確認できます。</p><p><img src="/blog/sharepoint-online/Testing-backoff-logic/Fiddler4.png" alt="Fiddler4"></p><h2 id="参考リンク"><a href="#参考リンク" class="headerlink" title="参考リンク"></a>参考リンク</h2><p>タイトル : SharePoint Online で調整またはブロックを回避する方法<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/general-development/how-to-avoid-getting-throttled-or-blocked-in-sharepoint-online">https://docs.microsoft.com/ja-jp/sharepoint/dev/general-development/how-to-avoid-getting-throttled-or-blocked-in-sharepoint-online</a></p><p>タイトル : jpspsupport/CSOMRetrySample<br>アドレス : <a href="https://github.com/jpspsupport/CSOMRetrySample">https://github.com/jpspsupport/CSOMRetrySample</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;HTTP 調整リトライ ロジックを実装した際に、特に弊社公開記事に記載されたカスタムコードを変更している場合は、論理テストを実施していただく</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>PnP PowerShell でテナントのフルコントロール権限を使用して接続する方法について</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/pnp-powershell-with-app-only-token/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/pnp-powershell-with-app-only-token/</id>
    <published>2020-05-20T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.875Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>テナント管理者として、PowerShell でテナント全体のサイト コンテンツに対し、何らかの操作を実施しようとした際には、アクセス権の問題が頻繁に浮上します。</p><p>Office 365 管理センターで指定した全体管理者または SharePoint 管理者の権限がある場合、あらゆる設定を実施することは可能です。<br>しかし、サイト コレクション管理者を別の管理者に委任している場合、自身に該当サイトの管理者権限が与えられていないと、そのままの状態でサイトの変更をしたりコンテンツを閲覧できるわけではありません。</p><p><img src="/blog/sharepoint-online/pnp-powershell-with-app-only-token/SiteCollectionAdminImage.png" alt="SiteCollectionAdminImage"></p><p>このような状況においては、何かテナント単位で各サイトに対する作業を実施しようとした際に、一時的に自分に各サイト コレクションの管理者権限を付与してから作業せざるを得ない状況に陥ります。SharePoint 管理ポータルや、Set-SPOUser -IsSiteCollectionAdmin $true などで設定は可能です。<br>しかし、多くのサイト コレクションの列挙など、一般的にこの追加実装や作業は、時間がかかることが予測されます。</p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>アプリ専用トークンを使用して、アプリにテナントに対する管理者権限を割り当てることができます。手順は以下のサイトにも記載があります。より詳細な情報については確認ください。</p><p>タイトル : SharePoint アプリ専用のアクセスを許可する<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/solution-guidance/security-apponly-azureacs">https://docs.microsoft.com/ja-jp/sharepoint/dev/solution-guidance/security-apponly-azureacs</a></p><h3 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h3><p><strong>1) ブラウザーで https://{tenant}.sharepoint.com/_layouts/15/appregnew.aspx を呼び出します。</strong><br>{tenant} の部分は、ご利用のテナント プリフィックスに基づいたアドレスに変えてください。</p><p><strong>イメージ</strong><br><br><img src="/blog/sharepoint-online/pnp-powershell-with-app-only-token/appregnew.png" alt="AppRegNew"></p><p> 1-1) クライアント ID とクライアント シークレットにて、それぞれ [生成] をクリックします。<br> 1-2) タイトルに任意の名前をしています。<br> 1-3) アプリドメインとリダイレクト先の URI には、指定のようにダミー値を記載します。<br>  (サーバー利用しませんので、ダミーで問題ありません。)<br> 1-4) [作成] をクリックします。<br> <strong>1-5) 次の画面で表示されるアプリの情報を厳重に保管してください。</strong></p><p><strong>2) 次にブラウザーで https://{tenant}-admin.sharepoint.com/_layouts/15/appinv.aspx を呼び出します。</strong><br> 2-1) アプリ ID に、先ほど登録したクライアント ID を入力して、アプリの情報を呼び出します。<br> 2-2) アプリのアクセス許可を付与するために XML を記載します。</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">AppPermissionRequests</span> <span class="attr">AllowAppOnlyPolicy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AppPermissionRequest</span> <span class="attr">Scope</span>=<span class="string">&quot;http://sharepoint/content/tenant&quot;</span> <span class="attr">Right</span>=<span class="string">&quot;FullControl&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">AppPermissionRequests</span>&gt;</span></span><br></pre></td></tr></table></figure><p> 2-3) [作成] をクリックします。 </p><p><strong>イメージ</strong><br><br><img src="/blog/sharepoint-online/pnp-powershell-with-app-only-token/appinv.png" alt="AppInv"></p><p> 2-4) [信頼する] をクリックします。</p><p><strong>イメージ</strong><br><br><img src="/blog/sharepoint-online/pnp-powershell-with-app-only-token/appinv2.png" alt="AppInv2"></p><p> 2-5) テナントでレガシーのアプリ専用トークンを有効化します。<br>   2020 年夏頃以降に新規作成したテナントにおいて、アプリ専用トークンが既定で無効化されている場合があります。その場合は <a href="https://support.microsoft.com/ja-jp/office/c16941c3-19b4-4710-8056-34c034493429">SharePoint Online 管理シェル</a> を使用してテナントの設定を変更ください。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-SPOTenant</span> <span class="literal">-DisableCustomAppAuthentication</span> <span class="variable">$FALSE</span></span><br></pre></td></tr></table></figure><p><strong>3) PnP PowerShell で以下のように接続します。後は、続けてコマンドレットを実行ください。</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Connect-PnPOnline</span> https://&#123;tenant&#125;.sharepoint.com <span class="literal">-ClientId</span> &lt;クライアント ID&gt; <span class="literal">-ClientSecret</span> &lt;クライアント シークレット&gt;</span><br></pre></td></tr></table></figure><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>アプリ専用トークンは、非常に強力です。しかし、クライアント ID やシークレットとなる情報に尽きましては、管理者アカウント・パスワードと同様、厳重に管理してくださいますようお願いします。</p><h2 id="その他"><a href="#その他" class="headerlink" title="その他"></a>その他</h2><p>Get-PnPContext コマンドを実行することで、ClientContext オブジェクトを取得できるため、このオブジェクトから利用できる様々な処理を実行することが可能です。<br>運用シナリオに応じて、CSOM 標準で用意されているコマンドレットとは別の処理を実行することができます。</p><h2 id="参考リンク"><a href="#参考リンク" class="headerlink" title="参考リンク"></a>参考リンク</h2><p>タイトル : PnP PowerShell の概要<br>アドレス : <a href="https://learn.microsoft.com/ja-jp/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets">https://learn.microsoft.com/ja-jp/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;テナント管理者として、PowerShell でテナント全体のサイト コンテンツに対し、何らかの操作を実施しようとした際には、アクセス権の問題</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>SharePoint Online でモダン エクスペリエンスを利用するメリット</title>
    <link href="https://jpspsupport.github.io/blog/sharepoint-online/modern-experience-advantage/"/>
    <id>https://jpspsupport.github.io/blog/sharepoint-online/modern-experience-advantage/</id>
    <published>2020-04-20T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.874Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>この記事は、<a href="https://social.msdn.microsoft.com/Forums/ja-JP/0b9b82cb-9826-4387-942b-954b68602128/sharepoint-online-?forum=sharepointsupportteamja">以前の SharePoint サポート フォーラムの投稿</a>を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></blockquote><p>SharePoint Online は複数の機能において、現在モダン エクスペリエンス/クラシック エクスペリエンスの 2 種類を提供しています。</p><p>クラシック エクスペリエンスを廃止する予定は現時点ではありませんが、SharePoint Online においてはモダン エクスペリエンスの利用を推奨しています。</p><p>今回はモダン エクスペリエンスが推奨される背景を紹介します。今後 SharePoint Online を快適にご利用頂くためにはモダン エクスペリエンスの利用を推奨していますので、本稿の内容を参考に、モダン エクスペリエンスの採用や移行を検討いただけると幸いです。</p><br/><h2 id="モダン-エクスペリエンスが提供された背景"><a href="#モダン-エクスペリエンスが提供された背景" class="headerlink" title="モダン エクスペリエンスが提供された背景"></a>モダン エクスペリエンスが提供された背景</h2><p>SharePoint はオンプレミス向けのサービスとして提供が開始されており、SharePoint Online はオンプレミス向けの SharePoint をベースに、クラウドの SaaS サービスとして提供が開始されました。</p><p>その後、Office 365 の普及に伴い SharePoint Online の利用者も大きく増加しています。データセンターも規模が拡大しており、SharePoint Online が稼働するインフラもサービス開始時とは大きく異なっています。</p><br/><p>オンプレミス向けの SharePoint は主にイントラネットでの利用が想定されており、サーバーの台数も一般的には数台から十数台程度となりますが、複数のテナントでインフラを共有する SharePoint Online は大多数のサーバーで稼働しています。</p><p>この様なインフラの違いが影響し、SharePoint Online でオンプレミス向け SharePoint をベースに提供された機能を利用していると、パフォーマンスに影響が生じる事例が散見されるようになりました。</p><p>具体例として、オンプレミス向け SharePoint は主にフロントエンドサーバーのキャッシュを利用してパフォーマンスを維持していましたが、大多数のサーバーで稼働する SharePoint Online ではアクセスが毎回異なるサーバーに分散され、前と同じサーバーにルーティングされる可能性が極めて低いため、フロントエンドサーバーが保持するキャッシュがほとんどヒットしません。</p><p>キャッシュが利用できないため、フロントエンドサーバーやバックエンドデータベースの処理量増加により負荷が大きくなり、テナントのパフォーマンスが劣化した事例が多数あります。</p><p>従来のオンプレミス向けのアーキテクチャではクラウドのインフラでパフォーマンスを維持することが困難となったため、クラウドのインフラに最適化された設計で開発されたのがモダン エクスペリエンスとなります。</p><br/><h2 id="モダン-エクスペリエンスが推奨される理由"><a href="#モダン-エクスペリエンスが推奨される理由" class="headerlink" title="モダン エクスペリエンスが推奨される理由"></a>モダン エクスペリエンスが推奨される理由</h2><p>SharePoint Online はマルチテナント型の SaaS サービスです。つまり、複数のテナントによってインフラが共有されています。<br>また、開発が継続されているため、各テナントに変更が都度反映されています。</p><p>このため、データセンター側の負荷状況の予測は非常に困難となっています。</p><p>モダン エクスペリエンスは、サーバー側の負荷状況の変動が影響しにくいように、以下の様な要素が取り入れられています。</p><br/><ul><li><p>CDN</p><ul><li>静的コンテンツを Office 365 サーバーとは異なるプロキシにキャッシュし、サーバーの負荷を軽減します。</li></ul></li><li><p>クライアントサイド指向</p><ul><li>サーバー側の処理を極力シンプルにし、クライアント側でビジネスロジックを実行します。</li></ul></li><li><p>マイクロサービスアーキテクチャ</p><ul><li>1 つのアプリケーションを、独立した小さいサービスの集合で構成する設計指針。スケーリングが容易で、単一のサービスに問題が生じてもアプリケーション全体に影響が生じにくくなります。</li></ul></li></ul><br/>また、モダン エクスペリエンスは引き続き積極的に開発されているため、機能の追加や修正が積極的に実施されていることも、モダン エクスペリエンスを採用するメリットとなります。<p>クラシック エクスペリエンスはレガシーな基盤である ASP.NET を利用しているため、新しい機能の追加や既存機能の修正が困難となっています。</p><br/>なお、上述の通りクラシック エクスペリエンスが廃止されるアナウンスは現時点ではありませんので、この点についてはご安心ください。<p>しかし、クラシック エクスペリエンスにおいてはパフォーマンスに関する考慮事項が多くあるので、特に多くのユーザーによって利用されるクラシック エクスペリエンスのサイトにおいては、弊社公開情報を参考にパフォーマンスチューニングを実施することを強く推奨します。</p><p>タイトル : SharePoint Online のパフォーマンスをチューニングする<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/office365/enterprise/tune-sharepoint-online-performance">https://docs.microsoft.com/ja-jp/office365/enterprise/tune-sharepoint-online-performance</a></p><p>タイトル : SharePoint Online ポータル パフォーマンス ガイダンス<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/dev/solution-guidance/portal-performance">https://docs.microsoft.com/ja-jp/sharepoint/dev/solution-guidance/portal-performance</a></p><br/><h2 id="クラッシック-モダンエクスペリエンスの対応"><a href="#クラッシック-モダンエクスペリエンスの対応" class="headerlink" title="クラッシック/モダンエクスペリエンスの対応"></a>クラッシック/モダンエクスペリエンスの対応</h2><p>各機能のクラシック エクスペリエンス/モダン エクスペリエンスの対応を紹介します。</p><table><thead><tr><th align="left">クラッシック エクスペリエンス</th><th align="left">モダン エクスペリエンス</th></tr></thead><tbody><tr><td align="left">チームサイト、発行ポータル、など</td><td align="left">モダンチームサイト、コミュニケーションサイト、ハブサイトなど</td></tr><tr><td align="left">サンドボックス ソリューション<br/>スクリプト エディター/コンテンツ エディター Web パーツ</td><td align="left">SharePoint Framework</td></tr><tr><td align="left">アンケートリスト</td><td align="left">Microsoft Forms</td></tr><tr><td align="left">タスクリスト</td><td align="left">Microsoft Planner</td></tr><tr><td align="left">予定表リスト</td><td align="left">Outlook Calendar (Office 365 Groups)</td></tr><tr><td align="left">ニュース（サイト）フィード、ディスカッション掲示板</td><td align="left">Yammer</td></tr><tr><td align="left">SharePoint ワークフロー</td><td align="left">Microsoft Flow (Power Automate)</td></tr><tr><td align="left">InfoPath</td><td align="left">Microsoft PowerApps</td></tr></tbody></table><br/>モダン エクスペリエンスはクラシック エクスペリエンスの機能を完全に包括するものではありませんが、モダン エクスペリエンスでのみ実現可能なことも多数あります。<p>一例として、クラシック エクスペリエンスで慎重に考慮する必要があったリストビューのしきい値が、モダン エクスペリエンスでは抵触しにくくなっています。</p><p>これは新しいアーキテクチャによって最適化されたデータアクセスを実現しているため、しきい値自体は存在するものの、多くの場合に抵触しにくい実装となっています。</p><p>本稿ではそれぞれの差異についての紹介は割愛しますが、是非動作をご確認いただき、長期的に SharePoint Online を快適にご利用頂くためには、モダン エクスペリエンスの採用を検討いただけると幸いです。</p><br/><p><em>追記</em></p><p>SharePoint Online でモダン エクスペリエンスをご利用いただく際のガイダンスとなる情報が公開されました。</p><p>タイトル : SharePoint でのモダンな機能のガイド<br>アドレス : <a href="https://docs.microsoft.com/ja-jp/sharepoint/guide-to-sharepoint-modern-experience">https://docs.microsoft.com/ja-jp/sharepoint/guide-to-sharepoint-modern-experience</a></p><p>モダン エクスペリエンスをご利用を検討される場合、こちらの情報も事前にご確認いただけると幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;この記事は、&lt;a href=&quot;https://social.msdn.microsoft.com/Forums/ja-JP/0b9b82cb-9826-4387-942b-954b68602128/sharepoint-online-?forum=</summary>
      
    
    
    
    
    <category term="SharePoint Online" scheme="https://jpspsupport.github.io/blog/tags/SharePoint-Online/"/>
    
  </entry>
  
  <entry>
    <title>SharePoint Support チームのブログへようこそ</title>
    <link href="https://jpspsupport.github.io/blog/general/welcome/"/>
    <id>https://jpspsupport.github.io/blog/general/welcome/</id>
    <published>2020-04-13T15:00:00.000Z</published>
    <updated>2025-09-09T08:22:29.865Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事は Technet Blog の更新停止に伴い、もともとばらばらに存在していた記事を一つのブログに集約／移行したものです。<br>元の記事の最新の更新情報については、本ブログの投稿をご参照ください。</p></blockquote><p>こんにちは。<br>SharePoint Support チームのブログです。</p><p>わたしたちサポートチームでは下記の製品のサポートを行っており、それぞれの製品に関する情報を本ブログで発信していきたいと考えています。</p><ul><li>SharePoint Online と OneDrive for Business</li><li>SharePoint Server (オンプレミス)</li><li>Microsoft Stream</li></ul><p>なお、本ブログは弊社の公式見解ではなく、予告なく変更される場合があります。<br>もし公式な見解が必要な場合は、弊社ドキュメント (<a href="https://learn.microsoft.com/">https://learn.microsoft.com</a> や <a href="https://support.microsoft.com/">https://support.microsoft.com</a>) をご参照いただく、もしくは私共サポートまでお問い合わせください。</p><p>本情報が少しでも皆様のお役に立てば幸いです😊</p><p>※過去のブログ記事は以下にアーカイブされております。<br>過去の記事を参照いただく際は、それぞれのリンク先から検索ください。<br>元の記事の最新の更新情報については、本ブログに掲載いたします。</p><p>Blog Archive : Japan SharePoint Support Team Blog<br><a href="https://learn.microsoft.com/ja-jp/archive/blogs/sharepoint_support/">https://learn.microsoft.com/ja-jp/archive/blogs/sharepoint_support/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事は Technet Blog の更新停止に伴い、もともとばらばらに存在していた記事を一つのブログに集約／移行したものです。&lt;br&gt;元の記事の最新の更新情報については、本ブログの投稿をご参照ください。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;</summary>
      
    
    
    
    
  </entry>
  
</feed>
